import{b as At,c as Ie,e as Re,f as Ne,g as Ae,h as De,i as Le,j as mo,k as _o,l as go,m as Fe,n as vo,o as Ue}from"./chunk-BLATYTEX.js";import{$a as Eo,$b as Go,A as Nt,Aa as oe,Ab as Xt,Ba as lo,Bb as Zt,Ca as co,Cb as No,Da as uo,Db as Ao,Ea as ho,Eb as Jt,F as g,Fa as re,Fb as ve,Ga as Oe,Gb as en,H as j,Ha as po,Hb as Do,I as ie,Ia as fo,Jb as Lo,Ka as _,Kb as Fo,La as Be,Lb as Uo,M as $,Ma as Co,Mb as An,Na as bo,Nb as Bo,O as ue,Oa as yo,P as E,Pa as Dt,Pb as Wo,Qa as In,Qb as Vo,R,Ra as it,Sa as Lt,T as u,Ta as Ft,U as h,Ua as Ut,Ub as zo,V as b,Va as Rn,Wa as wo,Wb as qo,Xa as se,Xb as Ho,Y as On,Ya as xo,Z as B,Za as Bt,_ as de,_a as A,aa as f,ab as Po,ba as ro,bb as ae,c as G,ca as nt,cb as ye,db as Nn,eb as ot,f as io,fa as W,fb as So,ga as V,gb as To,ha as z,hb as Mo,i as oo,ib as ko,ja as so,jb as Oo,kb as rt,lb as st,mb as Wt,nb as Io,o as Mt,oa as ao,ob as Ro,p as kn,pb as Vt,q as ne,qb as zt,r as kt,rb as qt,sb as Ht,t as Ot,tb as Gt,u as It,ub as le,v as P,vb as jt,w as N,wa as ge,wb as $t,xb as Yt,y as Rt,yb as Kt,zb as Qt}from"./chunk-VS7D342T.js";function ta(n,t){n&1&&(P(),b(0,"path",42))}function na(n,t){n&1&&(P(),b(0,"path",43))}function ia(n,t){if(n&1&&(u(0,"div",44),f(1),h()),n&2){let e=de();g(),nt(" ",e.errorMessage," ")}}var tn=class n{constructor(t,e){this.router=t;this.auth=e}email="";password="";rememberMe=!1;showPassword=!1;attempted=!1;errorMessage=null;togglePassword(){this.showPassword=!this.showPassword}onLogin(){return G(this,null,function*(){if(this.attempted=!0,this.errorMessage=null,!this.email||!this.password){this.errorMessage="Por favor, preencha o e-mail e a senha.";return}try{let t=yield Bo(this.auth,this.email,this.password);console.log("Login bem-sucedido!",t.user),this.router.navigate(["/home"])}catch(t){switch(console.error("Erro no login:",t),t.code){case"auth/user-not-found":case"auth/wrong-password":this.errorMessage="E-mail ou senha inv\xE1lidos.";break;case"auth/invalid-email":this.errorMessage="Formato de e-mail inv\xE1lido.";break;case"auth/user-disabled":this.errorMessage="Esta conta foi desativada.";break;default:this.errorMessage="Ocorreu um erro inesperado. Tente novamente.";break}}})}static \u0275fac=function(e){return new(e||n)(j(re),j(ve))};static \u0275cmp=ie({type:n,selectors:[["app-login"]],decls:61,vars:18,consts:[["role","main",1,"login-wrapper"],[1,"login-container"],[1,"login-header"],[1,"logo-section"],["src","assets/logo.png","alt","Logo da empresa",1,"logo-image"],[1,"welcome-content"],[1,"welcome-title"],[1,"welcome-subtitle"],[1,"login-main"],["novalidate","",1,"login-form",3,"ngSubmit"],[1,"form-fieldset"],[1,"sr-only"],[1,"form-group"],["for","email",1,"form-label"],["aria-label","campo obrigat\xF3rio",1,"required-indicator"],[1,"input-wrapper"],["type","email","id","email","name","email","placeholder","Digite seu e-mail","autocomplete","email","aria-describedby","email-error","required","",1,"form-input",3,"ngModelChange","ngModel"],["aria-hidden","true",1,"input-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"],["id","email-error",1,"error-message"],["for","password",1,"form-label"],["id","password","name","password","placeholder","Digite sua senha","autocomplete","current-password","aria-describedby","password-error","required","",1,"form-input",3,"ngModelChange","type","ngModel"],["type","button","tabindex","0",1,"password-toggle",3,"click"],["d","M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z",4,"ngIf"],["d","M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z",4,"ngIf"],["id","password-error",1,"error-message"],[1,"form-options"],[1,"checkbox-wrapper"],["type","checkbox","name","rememberMe",1,"checkbox-input",3,"ngModelChange","ngModel"],["aria-hidden","true",1,"checkbox-custom"],[1,"checkbox-label"],["routerLink","/esqueci-senha","tabindex","0",1,"forgot-link"],["class","error-message visible firebase-error",4,"ngIf"],["type","submit",1,"login-button",3,"disabled"],[1,"button-content"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor",1,"button-icon"],["d","M10,17V14H3V10H10V7L15,12L10,17M10,2H19A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H10A2,2 0 0,1 8,20V18H10V20H19V4H10V6H8V4A2,2 0 0,1 10,2Z"],["id","login-button-help",1,"sr-only"],[1,"login-footer"],[1,"signup-text"],["routerLink","/cadastro","tabindex","0",1,"signup-link"],["d","M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"],["d","M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"],[1,"error-message","visible","firebase-error"]],template:function(e,i){e&1&&(u(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3),b(4,"img",4),h(),u(5,"div",5)(6,"h1",6),f(7,"Bem-vindo de volta"),h(),u(8,"p",7),f(9,"Fa\xE7a login para acessar o sistema de gest\xE3o"),h()()(),u(10,"main",8)(11,"form",9),B("ngSubmit",function(){return i.onLogin()}),u(12,"fieldset",10)(13,"legend",11),f(14,"Dados de acesso"),h(),u(15,"div",12)(16,"label",13),f(17," E-mail "),u(18,"span",14),f(19,"*"),h()(),u(20,"div",15)(21,"input",16),z("ngModelChange",function(r){return V(i.email,r)||(i.email=r),r}),h(),u(22,"div",17),P(),u(23,"svg",18),b(24,"path",19),h()()(),N(),u(25,"div",20),f(26," Por favor, digite um e-mail v\xE1lido "),h()(),u(27,"div",12)(28,"label",21),f(29," Senha "),u(30,"span",14),f(31,"*"),h()(),u(32,"div",15)(33,"input",22),z("ngModelChange",function(r){return V(i.password,r)||(i.password=r),r}),h(),u(34,"button",23),B("click",function(){return i.togglePassword()}),P(),u(35,"svg",18),$(36,ta,1,0,"path",24)(37,na,1,0,"path",25),h()()(),N(),u(38,"div",26),f(39," Por favor, digite sua senha "),h()(),u(40,"div",27)(41,"label",28)(42,"input",29),z("ngModelChange",function(r){return V(i.rememberMe,r)||(i.rememberMe=r),r}),h(),b(43,"span",30),u(44,"span",31),f(45,"Lembrar de mim"),h()(),u(46,"a",32),f(47,"Esqueceu a senha?"),h()(),$(48,ia,2,1,"div",33),u(49,"button",34)(50,"span",35),P(),u(51,"svg",36),b(52,"path",37),h(),f(53," Entrar no Sistema "),h()(),N(),u(54,"div",38),f(55," Preencha e-mail e senha para habilitar o bot\xE3o de login "),h()()(),u(56,"footer",39)(57,"p",40),f(58," N\xE3o tem uma conta? "),u(59,"a",41),f(60," Cadastre-se gratuitamente "),h()()()()()()),e&2&&(g(21),R("error",!i.email&&i.attempted),W("ngModel",i.email),g(4),R("visible",!i.email&&i.attempted),g(8),R("error",!i.password&&i.attempted),E("type",i.showPassword?"text":"password"),W("ngModel",i.password),g(),ue("aria-label",i.showPassword?"Ocultar senha":"Mostrar senha"),g(2),E("ngIf",!i.showPassword),g(),E("ngIf",i.showPassword),g(),R("visible",!i.password&&i.attempted),g(4),W("ngModel",i.rememberMe),g(6),E("ngIf",i.errorMessage),g(),E("disabled",!i.email||!i.password),ue("aria-describedby",!i.email||!i.password?"login-button-help":null))},dependencies:[Ue,Le,Ie,At,Re,Ne,Fe,De,Ae,oe,ge,Oe],styles:['@charset "UTF-8";.login-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,var(--color-background-dark) 0%,var(--color-background-medium) 100%);display:flex;align-items:flex-start;justify-content:center;padding:20px;position:relative;overflow-y:auto}.login-wrapper[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 20%,rgba(29,161,242,.1) 0%,transparent 50%);pointer-events:none}.login-container[_ngcontent-%COMP%]{background-color:var(--color-background-light);border:1px solid var(--color-border);border-radius:12px;box-shadow:0 8px 25px #00000026;width:100%;max-width:420px;overflow:hidden;position:relative;z-index:1;margin:20px 0}.login-header[_ngcontent-%COMP%]{padding:40px 32px 32px;text-align:center;border-bottom:1px solid var(--color-border);background:linear-gradient(180deg,var(--color-background-light) 0%,var(--color-background-medium) 100%)}.logo-section[_ngcontent-%COMP%]{margin-bottom:24px}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{display:block;max-width:200px;width:100%;height:auto;margin:0 auto}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]{background:linear-gradient(45deg,var(--color-accent-blue),#1a91da);color:#fff;padding:16px 32px;border-radius:12px;font-weight:700;font-size:20px;letter-spacing:3px;font-family:Arial Black,sans-serif;text-shadow:0 2px 4px rgba(0,0,0,.3);display:inline-block;transition:all .3s ease}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.welcome-content[_ngcontent-%COMP%]   .welcome-title[_ngcontent-%COMP%]{color:var(--color-text-primary);font-size:28px;font-weight:700;margin:0 0 8px;line-height:1.2}.welcome-content[_ngcontent-%COMP%]   .welcome-subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:16px;margin:0;line-height:1.4}.login-main[_ngcontent-%COMP%]{padding:32px}.form-fieldset[_ngcontent-%COMP%]{border:none;margin:0;padding:0}.form-group[_ngcontent-%COMP%]{margin-bottom:24px}.form-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:32px}.form-label[_ngcontent-%COMP%]{display:block;color:var(--color-text-primary);font-size:14px;font-weight:600;margin-bottom:8px;line-height:1.4}.form-label[_ngcontent-%COMP%]   .required-indicator[_ngcontent-%COMP%]{color:#ff4757;margin-left:4px}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.form-input[_ngcontent-%COMP%]{width:100%;padding:16px 48px 16px 16px;background-color:var(--color-background-dark);border:2px solid var(--color-border);border-radius:8px;color:var(--color-text-primary);font-size:16px;line-height:1.4;transition:all .3s ease}.form-input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary);opacity:.8}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent-blue);box-shadow:0 0 0 3px #1da1f21a;background-color:var(--color-background-medium)}.form-input.error[_ngcontent-%COMP%]{border-color:#ff4757;box-shadow:0 0 0 3px #ff47571a}.form-input[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.input-icon[_ngcontent-%COMP%]{position:absolute;right:16px;color:var(--color-text-secondary);pointer-events:none;transition:all .3s ease}.form-input[_ngcontent-%COMP%]:focus + .input-icon[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:16px;background:none;border:none;color:var(--color-text-secondary);cursor:pointer;padding:4px;border-radius:4px;transition:all .3s ease}.password-toggle[_ngcontent-%COMP%]:hover, .password-toggle[_ngcontent-%COMP%]:focus{color:var(--color-text-primary);background-color:var(--color-background-medium);outline:2px solid var(--color-accent-blue);outline-offset:2px}.error-message[_ngcontent-%COMP%]{color:#ff4757;font-size:12px;margin-top:6px;opacity:0;transform:translateY(-4px);transition:all .3s ease}.error-message.visible[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.form-options[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]{position:absolute;opacity:0}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:checked + .checkbox-custom[_ngcontent-%COMP%]{background-color:var(--color-accent-blue);border-color:var(--color-accent-blue)}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:checked + .checkbox-custom[_ngcontent-%COMP%]:after{opacity:1;transform:scale(1)}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:focus + .checkbox-custom[_ngcontent-%COMP%]{outline:2px solid var(--color-accent-blue);outline-offset:2px}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-custom[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid var(--color-border);border-radius:4px;margin-right:10px;position:relative;transition:all .3s ease;display:flex;align-items:center;justify-content:center;flex-shrink:0}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-custom[_ngcontent-%COMP%]:after{content:"\\2713";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);color:#fff;font-size:11px;font-weight:700;opacity:0;transition:all .3s ease;line-height:1}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px;line-height:1.4}.forgot-link[_ngcontent-%COMP%]{color:var(--color-accent-blue);text-decoration:none;font-size:14px;font-weight:500;transition:all .3s ease}.forgot-link[_ngcontent-%COMP%]:hover, .forgot-link[_ngcontent-%COMP%]:focus{text-decoration:underline;outline:2px solid var(--color-accent-blue);outline-offset:2px;border-radius:4px;padding:2px 4px}.login-button[_ngcontent-%COMP%]{width:100%;padding:16px 24px;background:linear-gradient(135deg,var(--color-accent-blue) 0%,#1a91da 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden}.login-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s}.login-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.login-button[_ngcontent-%COMP%]:hover:not(:disabled):before{left:100%}.login-button[_ngcontent-%COMP%]:focus{outline:3px solid rgba(29,161,242,.3);outline-offset:2px}.login-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.login-button[_ngcontent-%COMP%]:disabled{background:var(--color-text-secondary);cursor:not-allowed;transform:none}.login-button[_ngcontent-%COMP%]:disabled:before{display:none}.button-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.button-icon[_ngcontent-%COMP%]{transition:all .3s ease}.login-button[_ngcontent-%COMP%]:hover:not(:disabled)   .button-icon[_ngcontent-%COMP%]{transform:translate(2px)}.login-footer[_ngcontent-%COMP%]{padding-top:24px;border-top:1px solid var(--color-border);text-align:center}.signup-text[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px;margin:0;line-height:1.4}.signup-link[_ngcontent-%COMP%]{color:var(--color-accent-blue);text-decoration:none;font-weight:600;transition:all .3s ease}.signup-link[_ngcontent-%COMP%]:hover, .signup-link[_ngcontent-%COMP%]:focus{text-decoration:underline;outline:2px solid var(--color-accent-blue);outline-offset:2px;border-radius:4px;padding:2px 4px}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}@media (max-width: 768px){.login-wrapper[_ngcontent-%COMP%]{padding:16px}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{max-width:160px}.login-container[_ngcontent-%COMP%]{max-width:100%}.login-header[_ngcontent-%COMP%]{padding:32px 24px 24px}.login-main[_ngcontent-%COMP%]{padding:24px}.welcome-title[_ngcontent-%COMP%]{font-size:24px}.welcome-subtitle[_ngcontent-%COMP%]{font-size:14px}.form-options[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}}@media (max-width: 480px){.login-wrapper[_ngcontent-%COMP%]{padding:12px}.login-header[_ngcontent-%COMP%]{padding:24px 20px 20px}.login-main[_ngcontent-%COMP%]{padding:20px}.welcome-title[_ngcontent-%COMP%]{font-size:22px}.form-input[_ngcontent-%COMP%]{padding:14px 44px 14px 14px;font-size:16px}.login-button[_ngcontent-%COMP%]{padding:14px 20px}}@media (prefers-contrast: high){.form-input[_ngcontent-%COMP%]{border-width:3px}.login-button[_ngcontent-%COMP%]{border:2px solid var(--color-text-primary)}}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%]{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}.error-message.firebase-error[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:0;text-align:center;font-size:14px;font-weight:700;padding:8px 12px;border-radius:6px;background-color:#ff47571a;border:1px solid #ff4757}']})};function oa(n,t){n&1&&(P(),b(0,"path",64))}function ra(n,t){n&1&&(P(),b(0,"path",65))}function sa(n,t){n&1&&(P(),b(0,"path",64))}function aa(n,t){n&1&&(P(),b(0,"path",65))}var rn=class n{constructor(t,e,i){this.router=t;this.auth=e;this.firestore=i}nome="";sobrenome="";email="";password="";confirmPassword="";cargo="";aceitaTermos=!1;showPassword=!1;showConfirmPassword=!1;attempted=!1;errorMessage=null;togglePassword(){this.showPassword=!this.showPassword}toggleConfirmPassword(){this.showConfirmPassword=!this.showConfirmPassword}isEmailValid(){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)}isPasswordValid(){return this.password.length>=6}passwordsMatch(){return this.password===this.confirmPassword}isFormValid(){return this.errorMessage=null,!this.nome||!this.sobrenome?!1:!this.email||!this.isEmailValid()?(this.attempted&&(this.errorMessage="Por favor, insira um e-mail v\xE1lido."),!1):!this.password||!this.isPasswordValid()?(this.attempted&&(this.errorMessage="A senha deve ter no m\xEDnimo 6 caracteres."),!1):!this.confirmPassword||!this.passwordsMatch()?(this.attempted&&(this.errorMessage="As senhas n\xE3o coincidem."),!1):this.cargo?this.aceitaTermos?!0:(this.attempted&&(this.errorMessage="Voc\xEA deve aceitar os termos de uso."),!1):!1}onCadastro(){return G(this,null,function*(){if(this.attempted=!0,this.errorMessage=null,this.isFormValid())try{let e=(yield Fo(this.auth,this.email,this.password)).user;if(e){let i=qo(zo(this.firestore,"users"),e.uid);yield Go(i,{nome:this.nome,sobrenome:this.sobrenome,email:this.email,cargo:this.cargo,createdAt:new Date,uid:e.uid}),console.log("Cadastro e dados adicionais salvos com sucesso:",e),alert("Conta criada com sucesso! Redirecionando para login..."),this.router.navigate(["/login"])}}catch(t){this.errorMessage=this.mapFirebaseAuthError(t.code),console.error("Erro no cadastro do Firebase:",t)}else this.errorMessage||(this.errorMessage="Por favor, preencha todos os campos corretamente.")})}mapFirebaseAuthError(t){switch(t){case"auth/email-already-in-use":return"Este e-mail j\xE1 est\xE1 em uso.";case"auth/invalid-email":return"O formato do e-mail \xE9 inv\xE1lido.";case"auth/operation-not-allowed":return"Cadastro por e-mail e senha n\xE3o est\xE1 habilitado. Contate o suporte.";case"auth/weak-password":return"A senha deve ter pelo menos 6 caracteres.";default:return"Ocorreu um erro inesperado. Tente novamente."}}static \u0275fac=function(e){return new(e||n)(j(re),j(ve),j(Wo))};static \u0275cmp=ie({type:n,selectors:[["app-cadastro"]],decls:132,vars:43,consts:[["role","main",1,"cadastro-wrapper"],[1,"cadastro-container"],[1,"cadastro-header"],[1,"logo-section"],["src","assets/logo.png","alt","Logo da empresa",1,"logo-image"],[1,"welcome-content"],[1,"welcome-title"],[1,"welcome-subtitle"],[1,"cadastro-main"],["novalidate","",1,"cadastro-form",3,"ngSubmit"],[1,"form-fieldset"],[1,"sr-only"],[1,"form-row"],[1,"form-group"],["for","nome",1,"form-label"],["aria-label","campo obrigat\xF3rio",1,"required-indicator"],[1,"input-wrapper"],["type","text","id","nome","name","nome","placeholder","Seu nome","autocomplete","given-name","aria-describedby","nome-error","required","",1,"form-input",3,"ngModelChange","ngModel"],["aria-hidden","true",1,"input-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"],["id","nome-error",1,"error-message"],["for","sobrenome",1,"form-label"],["type","text","id","sobrenome","name","sobrenome","placeholder","Seu sobrenome","autocomplete","family-name","aria-describedby","sobrenome-error","required","",1,"form-input",3,"ngModelChange","ngModel"],["id","sobrenome-error",1,"error-message"],["for","email",1,"form-label"],["type","email","id","email","name","email","placeholder","seu@email.com","autocomplete","email","aria-describedby","email-error email-help","required","",1,"form-input",3,"ngModelChange","ngModel"],["d","M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"],["id","email-help",1,"help-text"],["id","email-error",1,"error-message"],["for","password",1,"form-label"],["id","password","name","password","placeholder","M\xEDnimo 6 caracteres","autocomplete","new-password","aria-describedby","password-error password-help","required","",1,"form-input",3,"ngModelChange","type","ngModel"],["type","button","tabindex","0",1,"password-toggle",3,"click"],["d","M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z",4,"ngIf"],["d","M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z",4,"ngIf"],["id","password-help",1,"help-text"],["id","password-error",1,"error-message"],["for","confirmPassword",1,"form-label"],["id","confirmPassword","name","confirmPassword","placeholder","Repita a senha","autocomplete","new-password","aria-describedby","confirm-password-error","required","",1,"form-input",3,"ngModelChange","type","ngModel"],["id","confirm-password-error",1,"error-message"],["for","cargo",1,"form-label"],["id","cargo","name","cargo","aria-describedby","cargo-error","required","",1,"form-select",3,"ngModelChange","ngModel"],["value","","disabled",""],["value","tecnico"],["value","gerente"],["value","usuario"],["value","administrador"],["aria-hidden","true",1,"select-icon"],["d","M7,10L12,15L17,10H7Z"],["id","cargo-error",1,"error-message"],[1,"checkbox-wrapper"],["type","checkbox","name","aceitaTermos","aria-describedby","termos-error","required","",1,"checkbox-input",3,"ngModelChange","ngModel"],["aria-hidden","true",1,"checkbox-custom"],[1,"checkbox-label"],["href","#","tabindex","0",1,"terms-link"],["id","termos-error",1,"error-message"],["type","submit",1,"cadastro-button",3,"disabled"],[1,"button-content"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor",1,"button-icon"],["d","M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"],["id","cadastro-button-help",1,"sr-only"],[1,"cadastro-footer"],[1,"login-text"],["routerLink","/login","tabindex","0",1,"login-link"],["d","M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"],["d","M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"]],template:function(e,i){e&1&&(u(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3),b(4,"img",4),h(),u(5,"div",5)(6,"h1",6),f(7,"Criar nova conta"),h(),u(8,"p",7),f(9,"Preencha os dados para acessar o sistema de gest\xE3o"),h()()(),u(10,"main",8)(11,"form",9),B("ngSubmit",function(){return i.onCadastro()}),u(12,"fieldset",10)(13,"legend",11),f(14,"Dados pessoais e de acesso"),h(),u(15,"div",12)(16,"div",13)(17,"label",14),f(18," Nome "),u(19,"span",15),f(20,"*"),h()(),u(21,"div",16)(22,"input",17),z("ngModelChange",function(r){return V(i.nome,r)||(i.nome=r),r}),h(),u(23,"div",18),P(),u(24,"svg",19),b(25,"path",20),h()()(),N(),u(26,"div",21),f(27," Nome \xE9 obrigat\xF3rio "),h()(),u(28,"div",13)(29,"label",22),f(30," Sobrenome "),u(31,"span",15),f(32,"*"),h()(),u(33,"div",16)(34,"input",23),z("ngModelChange",function(r){return V(i.sobrenome,r)||(i.sobrenome=r),r}),h(),u(35,"div",18),P(),u(36,"svg",19),b(37,"path",20),h()()(),N(),u(38,"div",24),f(39," Sobrenome \xE9 obrigat\xF3rio "),h()()(),u(40,"div",13)(41,"label",25),f(42," E-mail "),u(43,"span",15),f(44,"*"),h()(),u(45,"div",16)(46,"input",26),z("ngModelChange",function(r){return V(i.email,r)||(i.email=r),r}),h(),u(47,"div",18),P(),u(48,"svg",19),b(49,"path",27),h()()(),N(),u(50,"div",28),f(51," Ser\xE1 usado para login e recupera\xE7\xE3o de senha "),h(),u(52,"div",29),f(53," Digite um e-mail v\xE1lido "),h()(),u(54,"div",12)(55,"div",13)(56,"label",30),f(57," Senha "),u(58,"span",15),f(59,"*"),h()(),u(60,"div",16)(61,"input",31),z("ngModelChange",function(r){return V(i.password,r)||(i.password=r),r}),h(),u(62,"button",32),B("click",function(){return i.togglePassword()}),P(),u(63,"svg",19),$(64,oa,1,0,"path",33)(65,ra,1,0,"path",34),h()()(),N(),u(66,"div",35),f(67," M\xEDnimo 6 caracteres "),h(),u(68,"div",36),f(69," Senha deve ter pelo menos 6 caracteres "),h()(),u(70,"div",13)(71,"label",37),f(72," Confirmar Senha "),u(73,"span",15),f(74,"*"),h()(),u(75,"div",16)(76,"input",38),z("ngModelChange",function(r){return V(i.confirmPassword,r)||(i.confirmPassword=r),r}),h(),u(77,"button",32),B("click",function(){return i.toggleConfirmPassword()}),P(),u(78,"svg",19),$(79,sa,1,0,"path",33)(80,aa,1,0,"path",34),h()()(),N(),u(81,"div",39),f(82," As senhas n\xE3o coincidem "),h()()(),u(83,"div",13)(84,"label",40),f(85," Cargo/Fun\xE7\xE3o "),u(86,"span",15),f(87,"*"),h()(),u(88,"div",16)(89,"select",41),z("ngModelChange",function(r){return V(i.cargo,r)||(i.cargo=r),r}),u(90,"option",42),f(91,"Selecione seu cargo"),h(),u(92,"option",43),f(93,"T\xE9cnico"),h(),u(94,"option",44),f(95,"Gerente"),h(),u(96,"option",45),f(97,"Usu\xE1rio"),h(),u(98,"option",46),f(99,"Administrador"),h()(),u(100,"div",47),P(),u(101,"svg",19),b(102,"path",48),h()()(),N(),u(103,"div",49),f(104," Selecione um cargo "),h()(),u(105,"div",13)(106,"label",50)(107,"input",51),z("ngModelChange",function(r){return V(i.aceitaTermos,r)||(i.aceitaTermos=r),r}),h(),b(108,"span",52),u(109,"span",53),f(110," Aceito os "),u(111,"a",54),f(112,"termos de uso"),h(),f(113," e "),u(114,"a",54),f(115,"pol\xEDtica de privacidade"),h(),u(116,"span",15),f(117,"*"),h()()(),u(118,"div",55),f(119," \xC9 necess\xE1rio aceitar os termos de uso "),h()(),u(120,"button",56)(121,"span",57),P(),u(122,"svg",58),b(123,"path",59),h(),f(124," Criar Conta "),h()(),N(),u(125,"div",60),f(126," Preencha todos os campos obrigat\xF3rios para habilitar o cadastro "),h()()(),u(127,"footer",61)(128,"p",62),f(129," J\xE1 tem uma conta? "),u(130,"a",63),f(131," Fa\xE7a login aqui "),h()()()()()()),e&2&&(g(22),R("error",!i.nome&&i.attempted),W("ngModel",i.nome),g(4),R("visible",!i.nome&&i.attempted),g(8),R("error",!i.sobrenome&&i.attempted),W("ngModel",i.sobrenome),g(4),R("visible",!i.sobrenome&&i.attempted),g(8),R("error",(!i.email||!i.isEmailValid())&&i.attempted),W("ngModel",i.email),g(6),R("visible",(!i.email||!i.isEmailValid())&&i.attempted),g(9),R("error",(!i.password||!i.isPasswordValid())&&i.attempted),E("type",i.showPassword?"text":"password"),W("ngModel",i.password),g(),ue("aria-label",i.showPassword?"Ocultar senha":"Mostrar senha"),g(2),E("ngIf",!i.showPassword),g(),E("ngIf",i.showPassword),g(3),R("visible",(!i.password||!i.isPasswordValid())&&i.attempted),g(8),R("error",(!i.confirmPassword||!i.passwordsMatch())&&i.attempted),E("type",i.showConfirmPassword?"text":"password"),W("ngModel",i.confirmPassword),g(),ue("aria-label",i.showConfirmPassword?"Ocultar confirma\xE7\xE3o":"Mostrar confirma\xE7\xE3o"),g(2),E("ngIf",!i.showConfirmPassword),g(),E("ngIf",i.showConfirmPassword),g(),R("visible",(!i.confirmPassword||!i.passwordsMatch())&&i.attempted),g(8),R("error",!i.cargo&&i.attempted),W("ngModel",i.cargo),g(14),R("visible",!i.cargo&&i.attempted),g(4),W("ngModel",i.aceitaTermos),g(11),R("visible",!i.aceitaTermos&&i.attempted),g(2),E("disabled",!i.isFormValid()),ue("aria-describedby",i.isFormValid()?null:"cadastro-button-help"))},dependencies:[Ue,Le,_o,go,Ie,At,mo,Re,Ne,Fe,vo,De,Ae,oe,ge,Oe],styles:['@charset "UTF-8";.cadastro-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,var(--color-background-dark) 0%,var(--color-background-medium) 100%);display:flex;align-items:flex-start;justify-content:center;padding:20px;position:relative;overflow-y:auto}.cadastro-wrapper[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 20%,rgba(29,161,242,.1) 0%,transparent 50%);pointer-events:none}.cadastro-container[_ngcontent-%COMP%]{background-color:var(--color-background-light);border:1px solid var(--color-border);border-radius:12px;box-shadow:0 8px 25px #00000026;width:100%;max-width:520px;overflow:hidden;position:relative;z-index:1;margin:20px 0}.cadastro-header[_ngcontent-%COMP%]{padding:32px 32px 24px;text-align:center;border-bottom:1px solid var(--color-border);background:linear-gradient(180deg,var(--color-background-light) 0%,var(--color-background-medium) 100%)}.logo-section[_ngcontent-%COMP%]{margin-bottom:20px}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{display:block;max-width:180px;width:100%;height:auto;margin:0 auto}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]{background:linear-gradient(45deg,var(--color-accent-blue),#1a91da);color:#fff;padding:12px 24px;border-radius:12px;font-weight:700;font-size:18px;letter-spacing:2px;font-family:Arial Black,sans-serif;text-shadow:0 2px 4px rgba(0,0,0,.3);display:inline-block;transition:all .3s ease}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.welcome-content[_ngcontent-%COMP%]   .welcome-title[_ngcontent-%COMP%]{color:var(--color-text-primary);font-size:24px;font-weight:700;margin:0 0 6px;line-height:1.2}.welcome-content[_ngcontent-%COMP%]   .welcome-subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px;margin:0;line-height:1.4}.cadastro-main[_ngcontent-%COMP%]{padding:24px 32px 32px}.form-fieldset[_ngcontent-%COMP%]{border:none;margin:0;padding:0}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:0}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:0}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}}.form-label[_ngcontent-%COMP%]{display:block;color:var(--color-text-primary);font-size:13px;font-weight:600;margin-bottom:6px;line-height:1.4}.form-label[_ngcontent-%COMP%]   .required-indicator[_ngcontent-%COMP%]{color:#ff4757;margin-left:3px}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{width:100%;padding:14px 44px 14px 14px;background-color:var(--color-background-dark);border:2px solid var(--color-border);border-radius:6px;color:var(--color-text-primary);font-size:14px;line-height:1.4;transition:all .3s ease}.form-input[_ngcontent-%COMP%]::placeholder, .form-select[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary);opacity:.8}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent-blue);box-shadow:0 0 0 3px #1da1f21a;background-color:var(--color-background-medium)}.form-input.error[_ngcontent-%COMP%], .error.form-select[_ngcontent-%COMP%]{border-color:#ff4757;box-shadow:0 0 0 3px #ff47571a}.form-input[_ngcontent-%COMP%]:disabled, .form-select[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.custom-select-container[_ngcontent-%COMP%]{position:relative;width:100%}.custom-select-trigger[_ngcontent-%COMP%]{width:100%;padding:14px 44px 14px 14px;background-color:var(--color-background-dark);border:2px solid var(--color-border);border-radius:6px;color:var(--color-text-primary);font-size:14px;line-height:1.4;transition:all .3s ease;cursor:pointer;display:flex;align-items:center;justify-content:space-between;text-align:left}.custom-select-trigger[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent-blue);box-shadow:0 0 0 3px #1da1f21a;background-color:var(--color-background-medium)}.custom-select-trigger.open[_ngcontent-%COMP%]{border-color:var(--color-accent-blue);border-bottom-left-radius:0;border-bottom-right-radius:0}.custom-select-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;z-index:10;max-height:200px;overflow-y:auto;background-color:var(--color-background-light);border:2px solid var(--color-accent-blue);border-top:none;border-bottom-left-radius:6px;border-bottom-right-radius:6px;box-shadow:0 8px 25px #00000026;padding:0;list-style:none;margin:0;display:none}.custom-select-trigger.open[_ngcontent-%COMP%] + .custom-select-options[_ngcontent-%COMP%]{display:block}.custom-select-option[_ngcontent-%COMP%]{padding:12px 14px;color:var(--color-text-primary);font-size:14px;cursor:pointer;transition:background-color .2s}.custom-select-option[_ngcontent-%COMP%]:hover, .custom-select-option.selected[_ngcontent-%COMP%]{background-color:var(--color-accent-blue);color:#fff}.form-select[_ngcontent-%COMP%]{appearance:none;cursor:pointer;background-image:none;color:var(--color-text-primary);padding-right:44px}.form-select[_ngcontent-%COMP%]::-ms-expand{display:none}.form-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:var(--color-background-dark);color:var(--color-text-primary);padding:8px 12px}.form-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{color:var(--color-text-secondary);opacity:.7}.form-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:checked, .form-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:hover{background-color:var(--color-accent-blue);color:#fff}.input-icon[_ngcontent-%COMP%], .select-icon[_ngcontent-%COMP%]{position:absolute;right:14px;color:var(--color-text-secondary);pointer-events:none;transition:all .3s ease}.form-input[_ngcontent-%COMP%]:focus + .input-icon[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]:focus + .input-icon[_ngcontent-%COMP%], .form-input[_ngcontent-%COMP%]:focus + .select-icon[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]:focus + .select-icon[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.input-icon[_ngcontent-%COMP%]   .custom-select-trigger.open[_ngcontent-%COMP%] + .select-icon[_ngcontent-%COMP%], .select-icon[_ngcontent-%COMP%]   .custom-select-trigger.open[_ngcontent-%COMP%] + .select-icon[_ngcontent-%COMP%]{transform:rotate(180deg)}.custom-select-trigger[_ngcontent-%COMP%] + .input-icon[_ngcontent-%COMP%], .custom-select-trigger[_ngcontent-%COMP%] + .select-icon[_ngcontent-%COMP%]{color:var(--color-text-secondary)}.custom-select-trigger[_ngcontent-%COMP%]:focus + .input-icon[_ngcontent-%COMP%], .custom-select-trigger[_ngcontent-%COMP%]:focus + .select-icon[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:14px;background:none;border:none;color:var(--color-text-secondary);cursor:pointer;padding:4px;border-radius:4px;transition:all .3s ease}.password-toggle[_ngcontent-%COMP%]:hover, .password-toggle[_ngcontent-%COMP%]:focus{color:var(--color-text-primary);background-color:var(--color-background-medium);outline:2px solid var(--color-accent-blue);outline-offset:2px}.help-text[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:11px;margin-top:4px;line-height:1.3}.error-message[_ngcontent-%COMP%]{color:#ff4757;font-size:11px;margin-top:4px;opacity:0;transform:translateY(-4px);transition:all .3s ease}.error-message.visible[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-start;cursor:pointer;-webkit-user-select:none;user-select:none;line-height:1.4}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]{position:absolute;opacity:0}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:checked + .checkbox-custom[_ngcontent-%COMP%]{background-color:var(--color-accent-blue);border-color:var(--color-accent-blue)}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:checked + .checkbox-custom[_ngcontent-%COMP%]:after{opacity:1;transform:scale(1)}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%]:focus + .checkbox-custom[_ngcontent-%COMP%]{outline:2px solid var(--color-accent-blue);outline-offset:2px}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-custom[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid var(--color-border);border-radius:3px;margin-right:10px;margin-top:1px;position:relative;transition:all .3s ease;flex-shrink:0;display:flex;align-items:center;justify-content:center}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-custom[_ngcontent-%COMP%]:after{content:"\\2713";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);color:#fff;font-size:11px;font-weight:700;opacity:0;transition:all .3s ease;line-height:1}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:13px;line-height:1.4}.checkbox-wrapper[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]   .required-indicator[_ngcontent-%COMP%]{color:#ff4757;margin-left:3px}.terms-link[_ngcontent-%COMP%]{color:var(--color-accent-blue);text-decoration:none;font-weight:500}.terms-link[_ngcontent-%COMP%]:hover, .terms-link[_ngcontent-%COMP%]:focus{text-decoration:underline;outline:2px solid var(--color-accent-blue);outline-offset:1px;border-radius:2px;padding:1px 2px}.cadastro-button[_ngcontent-%COMP%]{width:100%;padding:14px 20px;background:linear-gradient(135deg,var(--color-accent-blue) 0%,#1a91da 100%);color:#fff;border:none;border-radius:6px;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden;margin-bottom:20px}.cadastro-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s}.cadastro-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 8px 25px #00000026}.cadastro-button[_ngcontent-%COMP%]:hover:not(:disabled):before{left:100%}.cadastro-button[_ngcontent-%COMP%]:focus{outline:3px solid rgba(29,161,242,.3);outline-offset:2px}.cadastro-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.cadastro-button[_ngcontent-%COMP%]:disabled{background:var(--color-text-secondary);cursor:not-allowed;transform:none}.cadastro-button[_ngcontent-%COMP%]:disabled:before{display:none}.button-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px}.button-icon[_ngcontent-%COMP%]{transition:all .3s ease}.cadastro-button[_ngcontent-%COMP%]:hover:not(:disabled)   .button-icon[_ngcontent-%COMP%]{transform:translate(2px)}.cadastro-footer[_ngcontent-%COMP%]{padding-top:20px;border-top:1px solid var(--color-border);text-align:center}.login-text[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:13px;margin:0;line-height:1.4}.login-link[_ngcontent-%COMP%]{color:var(--color-accent-blue);text-decoration:none;font-weight:600;transition:all .3s ease}.login-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:focus{text-decoration:underline;outline:2px solid var(--color-accent-blue);outline-offset:2px;border-radius:4px;padding:2px 4px}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}@media (max-width: 768px){.cadastro-wrapper[_ngcontent-%COMP%]{padding:16px;align-items:flex-start}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{max-width:150px}.cadastro-container[_ngcontent-%COMP%]{max-width:100%;margin:10px 0}.cadastro-header[_ngcontent-%COMP%]{padding:24px 20px 20px}.cadastro-main[_ngcontent-%COMP%]{padding:20px}.welcome-title[_ngcontent-%COMP%]{font-size:22px}.welcome-subtitle[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 480px){.cadastro-wrapper[_ngcontent-%COMP%]{padding:12px}.cadastro-container[_ngcontent-%COMP%]{margin:5px 0}.cadastro-header[_ngcontent-%COMP%]{padding:20px 16px 16px}.cadastro-main[_ngcontent-%COMP%]{padding:16px}.welcome-title[_ngcontent-%COMP%]{font-size:20px}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{padding:12px 40px 12px 12px;font-size:16px}.cadastro-button[_ngcontent-%COMP%]{padding:12px 16px}}@media (prefers-contrast: high){.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-width:3px}.cadastro-button[_ngcontent-%COMP%]{border:2px solid var(--color-text-primary)}}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%]{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}']})};var at={production:!1,firebase:{apiKey:"AIzaSyACyeSMBCeBEWdWK2IjOMLHgqQ3IjIHP8M",authDomain:"sigti-f53e8.firebaseapp.com",projectId:"sigti-f53e8",storageBucket:"sigti-f53e8.firebasestorage.app",messagingSenderId:"993196296823",appId:"1:993196296823:web:ff15d39761cdc3d8845472",measurementId:"G-YS7W33BPM7",databaseURL:"https://sigti-f53e8-default-rtdb.firebaseio.com"},resetPasswordUrl:"http://localhost:4200/login"};function la(n,t){n&1&&(u(0,"p",18),f(1," Digite seu e-mail para receber as instru\xE7\xF5es de recupera\xE7\xE3o de senha "),h())}function ca(n,t){n&1&&(u(0,"p",18),f(1," Instru\xE7\xF5es enviadas! Verifique sua caixa de entrada e spam "),h())}function ua(n,t){n&1&&(u(0,"span",35),P(),u(1,"svg",36),b(2,"path",37),h(),f(3," Enviar instru\xE7\xF5es "),h())}function da(n,t){n&1&&(u(0,"span",35),P(),u(1,"svg",38),b(2,"path",39),h(),f(3," Enviando... "),h())}function ha(n,t){if(n&1){let e=On();u(0,"form",19),B("ngSubmit",function(){Ot(e);let o=de();return It(o.onSubmit())}),u(1,"fieldset",20)(2,"legend",21),f(3,"Recupera\xE7\xE3o de senha"),h(),u(4,"div",22)(5,"label",23),f(6," E-mail cadastrado "),u(7,"span",24),f(8,"*"),h()(),u(9,"div",25)(10,"input",26),z("ngModelChange",function(o){Ot(e);let r=de();return V(r.email,o)||(r.email=o),It(o)}),h(),u(11,"div",27),P(),u(12,"svg",28),b(13,"path",29),h()()(),N(),u(14,"div",30),f(15," Use o mesmo e-mail que voc\xEA utilizou para criar sua conta "),h(),u(16,"div",31),f(17),h()(),u(18,"button",32),$(19,ua,4,0,"span",33)(20,da,4,0,"span",33),h(),u(21,"div",34),f(22," Digite um e-mail v\xE1lido para habilitar o envio "),h()()()}if(n&2){let e=de();g(10),R("error",(!e.email||!e.isEmailValid())&&e.attempted||e.errorMessage),W("ngModel",e.email),E("disabled",e.isLoading),g(6),R("visible",e.attempted&&(!e.email||!e.isEmailValid())||e.errorMessage),g(),nt(" ",e.errorMessage||(e.attempted&&(!e.email||!e.isEmailValid())?"Digite um e-mail v\xE1lido":"")," "),g(),E("disabled",!e.email||!e.isEmailValid()||e.isLoading),ue("aria-describedby",!e.email||!e.isEmailValid()||e.errorMessage?"submit-button-help":null),g(),E("ngIf",!e.isLoading),g(),E("ngIf",e.isLoading)}}function pa(n,t){n&1&&(u(0,"span"),f(1,"Reenviar e-mail"),h())}function fa(n,t){if(n&1&&(u(0,"span"),f(1),h()),n&2){let e=de(2);g(),nt("Reenviar em ",e.resendCooldown,"s")}}function ma(n,t){if(n&1){let e=On();u(0,"div",40)(1,"div",41),P(),u(2,"svg",42),b(3,"path",43),h()(),N(),u(4,"h2",44),f(5,"E-mail enviado com sucesso!"),h(),u(6,"div",45)(7,"p"),f(8,"Enviamos as instru\xE7\xF5es para:"),h(),u(9,"strong",46),f(10),h()(),u(11,"div",47)(12,"h3"),f(13,"Pr\xF3ximos passos:"),h(),u(14,"ol",48)(15,"li"),f(16,"Verifique sua caixa de entrada"),h(),u(17,"li"),f(18,"Procure tamb\xE9m na pasta de spam"),h(),u(19,"li"),f(20,"Clique no link de recupera\xE7\xE3o"),h(),u(21,"li"),f(22,"Crie uma nova senha"),h()()(),u(23,"button",49),B("click",function(){Ot(e);let o=de();return It(o.resendEmail())}),$(24,pa,2,0,"span",50)(25,fa,2,1,"span",50),h()()}if(n&2){let e=de();g(10),ro(e.email),g(13),E("disabled",e.resendCooldown>0),g(),E("ngIf",e.resendCooldown===0),g(),E("ngIf",e.resendCooldown>0)}}var sn=class n{constructor(t){this.auth=t}email="";attempted=!1;isLoading=!1;emailSent=!1;resendCooldown=0;cooldownInterval;errorMessage=null;isEmailValid(){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)}onSubmit(){return G(this,null,function*(){if(this.attempted=!0,this.errorMessage=null,this.email&&this.isEmailValid()){this.isLoading=!0;try{let t={url:at.resetPasswordUrl,handleCodeInApp:!0};yield An(this.auth,this.email,t),this.emailSent=!0,this.startResendCooldown(),console.log("E-mail de recupera\xE7\xE3o de senha enviado para:",this.email)}catch(t){this.errorMessage=this.mapFirebaseAuthError(t.code),console.error("Erro ao enviar e-mail de recupera\xE7\xE3o:",t),this.emailSent=!1}finally{this.isLoading=!1}}else this.errorMessage||(this.errorMessage="Por favor, insira um e-mail v\xE1lido.")})}resendEmail(){return G(this,null,function*(){if(!(this.resendCooldown>0||this.isLoading)){this.isLoading=!0,this.errorMessage=null,console.log("Tentando reenviar e-mail de recupera\xE7\xE3o para:",this.email);try{let t={url:at.resetPasswordUrl,handleCodeInApp:!0};yield An(this.auth,this.email,t),console.log("E-mail de recupera\xE7\xE3o reenviado com sucesso."),this.startResendCooldown()}catch(t){this.errorMessage=this.mapFirebaseAuthError(t.code),console.error("Erro ao reenviar e-mail de recupera\xE7\xE3o:",t)}finally{this.isLoading=!1}}})}startResendCooldown(){this.resendCooldown=60,this.clearCooldown(),this.cooldownInterval=window.setInterval(()=>{this.resendCooldown--,this.resendCooldown<=0&&this.clearCooldown()},1e3)}clearCooldown(){this.cooldownInterval&&(clearInterval(this.cooldownInterval),this.cooldownInterval=void 0)}ngOnDestroy(){this.clearCooldown()}mapFirebaseAuthError(t){switch(t){case"auth/invalid-email":return"O e-mail fornecido \xE9 inv\xE1lido.";case"auth/user-not-found":return"N\xE3o h\xE1 registro de usu\xE1rio correspondente a este e-mail.";case"auth/missing-continue-uri":return"A URL de continua\xE7\xE3o \xE9 obrigat\xF3ria. Contate o suporte.";case"auth/unauthorized-continue-uri":return"O dom\xEDnio da URL de continua\xE7\xE3o n\xE3o est\xE1 autorizado. Verifique os dom\xEDnios autorizados no console Firebase.";default:return"Ocorreu um erro inesperado. Tente novamente."}}static \u0275fac=function(e){return new(e||n)(j(ve))};static \u0275cmp=ie({type:n,selectors:[["app-esqueci-senha"]],decls:23,vars:4,consts:[["role","main",1,"forgot-password-wrapper"],[1,"forgot-password-container"],[1,"forgot-password-header"],[1,"logo-section"],["src","assets/logo.png","alt","Logo da empresa",1,"logo-image"],[1,"content-section"],[1,"main-title"],["class","subtitle",4,"ngIf"],[1,"forgot-password-main"],["class","forgot-password-form","novalidate","",3,"ngSubmit",4,"ngIf"],["class","success-message",4,"ngIf"],[1,"forgot-password-footer"],[1,"navigation-links"],["routerLink","/login","tabindex","0",1,"back-link"],["width","16","height","16","viewBox","0 0 24 24","fill","currentColor"],["d","M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"],["aria-hidden","true",1,"separator"],["routerLink","/cadastro","tabindex","0",1,"signup-link"],[1,"subtitle"],["novalidate","",1,"forgot-password-form",3,"ngSubmit"],[1,"form-fieldset"],[1,"sr-only"],[1,"form-group"],["for","email",1,"form-label"],["aria-label","campo obrigat\xF3rio",1,"required-indicator"],[1,"input-wrapper"],["type","email","id","email","name","email","placeholder","Digite o e-mail da sua conta","autocomplete","email","aria-describedby","email-error email-help","required","",1,"form-input",3,"ngModelChange","ngModel","disabled"],["aria-hidden","true",1,"input-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"],["id","email-help",1,"help-text"],["id","email-error",1,"error-message"],["type","submit",1,"submit-button",3,"disabled"],["class","button-content",4,"ngIf"],["id","submit-button-help",1,"sr-only"],[1,"button-content"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor",1,"button-icon"],["d","M2,21L23,12L2,3V10L17,12L2,14V21Z"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor",1,"loading-icon"],["d","M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"],[1,"success-message"],["aria-hidden","true",1,"success-icon"],["width","64","height","64","viewBox","0 0 24 24","fill","currentColor"],["d","M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"],[1,"success-title"],[1,"success-details"],[1,"email-display"],[1,"next-steps"],[1,"steps-list"],["type","button",1,"resend-button",3,"click","disabled"],[4,"ngIf"]],template:function(e,i){e&1&&(u(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3),b(4,"img",4),h(),u(5,"div",5)(6,"h1",6),f(7,"Recuperar senha"),h(),$(8,la,2,0,"p",7)(9,ca,2,0,"p",7),h()(),u(10,"main",8),$(11,ha,23,11,"form",9)(12,ma,26,4,"div",10),u(13,"footer",11)(14,"div",12)(15,"a",13),P(),u(16,"svg",14),b(17,"path",15),h(),f(18," Voltar para login "),h(),N(),u(19,"span",16),f(20,"\u2022"),h(),u(21,"a",17),f(22," Criar nova conta "),h()()()()()()),e&2&&(g(8),E("ngIf",!i.emailSent),g(),E("ngIf",i.emailSent),g(2),E("ngIf",!i.emailSent),g(),E("ngIf",i.emailSent))},dependencies:[Ue,Le,Ie,Re,Ne,Fe,De,Ae,oe,ge,Oe],styles:['.forgot-password-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,var(--color-background-dark) 0%,var(--color-background-medium) 100%);display:flex;align-items:flex-start;justify-content:center;padding:20px;position:relative;overflow-y:auto}.forgot-password-wrapper[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 70% 30%,rgba(29,161,242,.08) 0%,transparent 50%);pointer-events:none}.forgot-password-container[_ngcontent-%COMP%]{background-color:var(--color-background-light);border:1px solid var(--color-border);border-radius:12px;box-shadow:0 8px 25px #00000026;width:100%;max-width:440px;overflow:hidden;position:relative;z-index:1;margin:20px 0}.forgot-password-header[_ngcontent-%COMP%]{padding:40px 32px 32px;text-align:center;border-bottom:1px solid var(--color-border);background:linear-gradient(180deg,var(--color-background-light) 0%,var(--color-background-medium) 100%)}.logo-section[_ngcontent-%COMP%]{margin-bottom:24px}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{display:block;max-width:180px;width:100%;height:auto;margin:0 auto}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]{background:linear-gradient(45deg,var(--color-accent-blue),#1a91da);color:#fff;padding:16px 32px;border-radius:12px;font-weight:700;font-size:20px;letter-spacing:3px;font-family:Arial Black,sans-serif;text-shadow:0 2px 4px rgba(0,0,0,.3);display:inline-block;transition:all .3s ease}.logo-section[_ngcontent-%COMP%]   .logo-placeholder[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.content-section[_ngcontent-%COMP%]   .main-title[_ngcontent-%COMP%]{color:var(--color-text-primary);font-size:28px;font-weight:700;margin:0 0 12px;line-height:1.2}.content-section[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:16px;line-height:1.5;max-width:320px;margin:0 auto}.forgot-password-main[_ngcontent-%COMP%]{padding:32px}.form-fieldset[_ngcontent-%COMP%]{border:none;margin:0;padding:0}.form-group[_ngcontent-%COMP%]{margin-bottom:32px}.form-label[_ngcontent-%COMP%]{display:block;color:var(--color-text-primary);font-size:14px;font-weight:600;margin-bottom:8px;line-height:1.4}.form-label[_ngcontent-%COMP%]   .required-indicator[_ngcontent-%COMP%]{color:#ff4757;margin-left:4px}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.form-input[_ngcontent-%COMP%]{width:100%;padding:16px 48px 16px 16px;background-color:var(--color-background-dark);border:2px solid var(--color-border);border-radius:8px;color:var(--color-text-primary);font-size:16px;line-height:1.4;transition:all .3s ease}.form-input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary);opacity:.8}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-accent-blue);box-shadow:0 0 0 3px #1da1f21a;background-color:var(--color-background-medium)}.form-input.error[_ngcontent-%COMP%]{border-color:#ff4757;box-shadow:0 0 0 3px #ff47571a}.form-input[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.input-icon[_ngcontent-%COMP%]{position:absolute;right:16px;color:var(--color-text-secondary);pointer-events:none;transition:all .3s ease}.form-input[_ngcontent-%COMP%]:focus + .input-icon[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.help-text[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:12px;margin-top:6px;line-height:1.4}.error-message[_ngcontent-%COMP%]{color:#ff4757;font-size:12px;margin-top:6px;opacity:0;transform:translateY(-4px);transition:all .3s ease}.error-message.visible[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.submit-button[_ngcontent-%COMP%]{width:100%;padding:16px 24px;background:linear-gradient(135deg,var(--color-accent-blue) 0%,#1a91da 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden}.submit-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled):before{left:100%}.submit-button[_ngcontent-%COMP%]:focus{outline:3px solid rgba(29,161,242,.3);outline-offset:2px}.submit-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.submit-button[_ngcontent-%COMP%]:disabled{background:var(--color-text-secondary);cursor:not-allowed;transform:none}.submit-button[_ngcontent-%COMP%]:disabled:before{display:none}.button-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.button-icon[_ngcontent-%COMP%]{transition:all .3s ease}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled)   .button-icon[_ngcontent-%COMP%]{transform:translate(2px)}.loading-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.success-message[_ngcontent-%COMP%]{text-align:center;padding:20px 0}.success-icon[_ngcontent-%COMP%]{color:#2ed573;margin-bottom:20px}.success-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 4px rgba(46,213,115,.3))}.success-title[_ngcontent-%COMP%]{color:var(--color-text-primary);font-size:24px;font-weight:700;margin:0 0 16px}.success-details[_ngcontent-%COMP%]{margin-bottom:24px}.success-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px;margin:0 0 8px}.success-details[_ngcontent-%COMP%]   .email-display[_ngcontent-%COMP%]{color:var(--color-accent-blue);font-size:16px;word-break:break-word}.next-steps[_ngcontent-%COMP%]{background-color:var(--color-background-dark);border:1px solid var(--color-border);border-radius:8px;padding:20px;margin-bottom:24px;text-align:left}.next-steps[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--color-text-primary);font-size:16px;font-weight:600;margin:0 0 12px}.next-steps[_ngcontent-%COMP%]   .steps-list[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px;line-height:1.6;margin:0;padding-left:20px}.next-steps[_ngcontent-%COMP%]   .steps-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px}.next-steps[_ngcontent-%COMP%]   .steps-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.resend-button[_ngcontent-%COMP%]{background:transparent;border:2px solid var(--color-border);color:var(--color-text-secondary);padding:12px 24px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .3s ease}.resend-button[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--color-accent-blue);color:var(--color-accent-blue);background-color:#1da1f20d}.resend-button[_ngcontent-%COMP%]:focus{outline:2px solid var(--color-accent-blue);outline-offset:2px}.resend-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.forgot-password-footer[_ngcontent-%COMP%]{padding-top:24px;border-top:1px solid var(--color-border)}.navigation-links[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap}.back-link[_ngcontent-%COMP%], .signup-link[_ngcontent-%COMP%]{color:var(--color-accent-blue);text-decoration:none;font-size:14px;font-weight:500;transition:all .3s ease;display:flex;align-items:center;gap:4px}.back-link[_ngcontent-%COMP%]:hover, .back-link[_ngcontent-%COMP%]:focus, .signup-link[_ngcontent-%COMP%]:hover, .signup-link[_ngcontent-%COMP%]:focus{text-decoration:underline;outline:2px solid var(--color-accent-blue);outline-offset:2px;border-radius:4px;padding:2px 4px}.separator[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:14px}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}@media (max-width: 768px){.forgot-password-wrapper[_ngcontent-%COMP%]{padding:16px}.logo-section[_ngcontent-%COMP%]   .logo-image[_ngcontent-%COMP%]{max-width:150px}.forgot-password-container[_ngcontent-%COMP%]{max-width:100%}.forgot-password-header[_ngcontent-%COMP%]{padding:32px 24px 24px}.forgot-password-main[_ngcontent-%COMP%]{padding:24px}.main-title[_ngcontent-%COMP%]{font-size:24px}.subtitle[_ngcontent-%COMP%]{font-size:14px}.navigation-links[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.navigation-links[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{display:none}}@media (max-width: 480px){.forgot-password-wrapper[_ngcontent-%COMP%]{padding:12px}.forgot-password-header[_ngcontent-%COMP%]{padding:24px 20px 20px}.forgot-password-main[_ngcontent-%COMP%]{padding:20px}.main-title[_ngcontent-%COMP%]{font-size:22px}.form-input[_ngcontent-%COMP%]{padding:14px 44px 14px 14px;font-size:16px}.submit-button[_ngcontent-%COMP%]{padding:14px 20px}}@media (prefers-contrast: high){.form-input[_ngcontent-%COMP%]{border-width:3px}.submit-button[_ngcontent-%COMP%], .resend-button[_ngcontent-%COMP%]{border:2px solid var(--color-text-primary)}}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%]{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}.loading-icon[_ngcontent-%COMP%]{animation:none}}']})};var We=(n,t)=>{let e=kn(ve),i=kn(re);return Lo(e).pipe(io(o=>o?!0:(console.log("Acesso negado. Redirecionando para login."),i.createUrlTree(["/login"]))))};var Yo=[{path:"",redirectTo:"/login",pathMatch:"full"},{path:"login",component:tn},{path:"cadastro",component:rn},{path:"esqueci-senha",component:sn},{path:"dashboard",canActivate:[We],loadComponent:()=>import("./chunk-AOUBCCQ6.js").then(n=>n.DashboardComponent)},{path:"ativos",canActivate:[We],loadComponent:()=>import("./chunk-C5QLHY5D.js").then(n=>n.AtivosComponent)},{path:"ativos/novo",canActivate:[We],loadComponent:()=>import("./chunk-HW2C7NJV.js").then(n=>n.AssetFormComponent)},{path:"chamados",canActivate:[We],loadComponent:()=>import("./chunk-FAUCHNHE.js").then(n=>n.ChamadosComponent)},{path:"relatorios",canActivate:[We],loadComponent:()=>import("./chunk-IPT6JSDG.js").then(n=>n.RelatoriosComponent)},{path:"**",redirectTo:"/dashboard"}];var Ko="@firebase/database",Qo="1.0.20";var Ai="";function _a(n){Ai=n}var Hn=class{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),A(e))}get(t){let e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:Bt(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}};var Gn=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return ae(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}};var Mr=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Hn(t)}}catch{}return new Gn},xe=Mr("localStorage"),jn=Mr("sessionStorage");var He=new Ro("@firebase/database"),ga=function(){let n=1;return function(){return n++}}(),kr=function(n){let t=Oo(n),e=new Mo;e.update(t);let i=e.digest();return Co.encodeByteArray(i)},bt=function(...n){let t="";for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?t+=bt.apply(null,i):typeof i=="object"?t+=A(i):t+=i,t+=" "}return t},Ee=null,Xo=!0,va=function(n,t){_(!t||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(He.logLevel=Io.VERBOSE,Ee=He.log.bind(He),t&&jn.set("logging_enabled",!0)):typeof n=="function"?Ee=n:(Ee=null,jn.remove("logging_enabled"))},L=function(...n){if(Xo===!0&&(Xo=!1,Ee===null&&jn.get("logging_enabled")===!0&&va(!0)),Ee){let t=bt.apply(null,n);Ee(t)}},yt=function(n){return function(...t){L(n,...t)}},$n=function(...n){let t="FIREBASE INTERNAL ERROR: "+bt(...n);He.error(t)},pe=function(...n){let t=`FIREBASE FATAL ERROR: ${bt(...n)}`;throw He.error(t),new Error(t)},Y=function(...n){let t="FIREBASE WARNING: "+bt(...n);He.warn(t)},Ca=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Y("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Or=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ba=function(n){if(se()||document.readyState==="complete")n();else{let t=!1,e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},je="[MIN_NAME]",Pe="[MAX_NAME]",Je=function(n,t){if(n===t)return 0;if(n===je||t===Pe)return-1;if(t===je||n===Pe)return 1;{let e=Zo(n),i=Zo(t);return e!==null?i!==null?e-i===0?n.length-t.length:e-i:-1:i!==null?1:n<t?-1:1}},ya=function(n,t){return n===t?0:n<t?-1:1},lt=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+A(t))},Di=function(n){if(typeof n!="object"||n===null)return A(n);let t=[];for(let i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)i!==0&&(e+=","),e+=A(t[i]),e+=":",e+=Di(n[t[i]]);return e+="}",e},Ir=function(n,t){let e=n.length;if(e<=t)return[n];let i=[];for(let o=0;o<e;o+=t)o+t>e?i.push(n.substring(o,e)):i.push(n.substring(o,o+t));return i};function X(n,t){for(let e in n)n.hasOwnProperty(e)&&t(e,n[e])}var Rr=function(n){_(!Or(n),"Invalid JSON number");let t=11,e=52,i=(1<<t-1)-1,o,r,s,a,l;n===0?(r=0,s=0,o=1/n===-1/0?1:0):(o=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,s=Math.round(n*Math.pow(2,e-a)-Math.pow(2,e))):(r=0,s=Math.round(n/Math.pow(2,1-i-e))));let c=[];for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);for(l=t;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(o?1:0),c.reverse();let d=c.join(""),p="";for(l=0;l<64;l+=8){let m=parseInt(d.substr(l,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},wa=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},xa=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};var Ea=new RegExp("^-?(0*)\\d{1,10}$"),Pa=-2147483648,Sa=2147483647,Zo=function(n){if(Ea.test(n)){let t=Number(n);if(t>=Pa&&t<=Sa)return t}return null},wt=function(n){try{n()}catch(t){setTimeout(()=>{let e=t.stack||"";throw Y("Exception was thrown by user callback.",e),t},Math.floor(0))}},Ta=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},pt=function(n,t){let e=setTimeout(n,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};var Yn=class{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,qt(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;(e=this.appCheckProvider)===null||e===void 0||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){Y(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Kn=class{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(o=>this.auth_=o)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(L("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Y(t)}},ft=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),ln="5",Nr="v",Ar="s",Dr="r",Lr="f",Fr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ur="ls",Br="p",Qn="ac",Wr="websocket",Vr="long_polling";var cn=class{constructor(t,e,i,o,r=!1,s="",a=!1,l=!1,c=null){this.secure=e,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xe.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&xe.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){let t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}};function Ma(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function zr(n,t,e){_(typeof t=="string","typeof type must == string"),_(typeof e=="object","typeof params must == object");let i;if(t===Wr)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(t===Vr)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);Ma(n)&&(e.ns=n.namespace);let o=[];return X(e,(r,s)=>{o.push(r+"="+s)}),i+o.join("&")}var Xn=class{constructor(){this.counters_={}}incrementCounter(t,e=1){ae(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return yo(this.counters_)}};var Fn={},Un={};function Li(n){let t=n.toString();return Fn[t]||(Fn[t]=new Xn),Fn[t]}function ka(n,t){let e=n.toString();return Un[e]||(Un[e]=t()),Un[e]}var Zn=class{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<i.length;++o)i[o]&&wt(()=>{this.onMessage_(i[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Jo="start",Oa="close",Ia="pLPCommand",Ra="pRTLPCB",qr="id",Hr="pw",Gr="ser",Na="cb",Aa="seg",Da="ts",La="d",Fa="dframe",jr=1870,$r=30,Ua=jr-$r,Ba=25e3,Wa=3e4,Jn=class n{constructor(t,e,i,o,r,s,a){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=o,this.authToken=r,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=yt(t),this.stats_=Li(e),this.urlFn=l=>(this.appCheckToken&&(l[Qn]=this.appCheckToken),zr(e,Vr,l))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Zn(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Wa)),ba(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ei((...r)=>{let[s,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,s===Jo)this.id=a,this.password=l;else if(s===Oa)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+s)},(...r)=>{let[s,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(s,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Jo]="t",i[Gr]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Na]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Nr]=ln,this.transportSessionId&&(i[Ar]=this.transportSessionId),this.lastSessionId&&(i[Ur]=this.lastSessionId),this.applicationId&&(i[Br]=this.applicationId),this.appCheckToken&&(i[Qn]=this.appCheckToken),typeof location<"u"&&location.hostname&&Fr.test(location.hostname)&&(i[Dr]=Lr);let o=this.urlFn(i);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return se()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!wa()&&!xa()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){let e=A(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);let i=bo(e),o=Ir(i,Ua);for(let r=0;r<o.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[r]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(se())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Fa]="t",i[qr]=t,i[Hr]=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){let e=A(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}},ei=class n{constructor(t,e,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,se())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=ga(),window[Ia+this.uniqueCallbackIdentifier]=t,window[Ra+this.uniqueCallbackIdentifier]=e,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let s="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(a){L("frame writing exception"),a.stack&&L(a.stack),L(a)}}}static createIFrame_(){let t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||L("No IE domain setting required")}catch{let i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let t={};t[qr]=this.myID,t[Hr]=this.myPW,t[Gr]=this.currentSerial;let e=this.urlFn(t),i="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+$r+i.length<=jr;){let s=this.pendingSegs.shift();i=i+"&"+Aa+o+"="+s.seg+"&"+Da+o+"="+s.ts+"&"+La+o+"="+s.d,o++}return e=e+i,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);let i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},o=setTimeout(i,Math.floor(Ba)),r=()=>{clearTimeout(o),i()};this.addTag(t,r)}addTag(t,e){se()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){let o=i.readyState;(!o||o==="loaded"||o==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{L("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Va=16384,za=45e3,un=null;typeof MozWebSocket<"u"?un=MozWebSocket:typeof WebSocket<"u"&&(un=WebSocket);var ct=(()=>{class n{constructor(e,i,o,r,s,a,l){this.connId=e,this.applicationId=o,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=yt(this.connId),this.stats_=Li(i),this.connURL=n.connectionURL_(i,a,l,r,o),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,o,r,s){let a={};return a[Nr]=ln,!se()&&typeof location<"u"&&location.hostname&&Fr.test(location.hostname)&&(a[Dr]=Lr),i&&(a[Ar]=i),o&&(a[Ur]=o),r&&(a[Qn]=r),s&&(a[Br]=s),zr(e,Wr,a)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xe.set("previous_websocket_failure",!0);try{let o;if(se()){let r=this.nodeAdmin?"AdminNode":"Node";o={headers:{"User-Agent":`Firebase/${ln}/${Ai}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(o.headers["X-Firebase-AppCheck"]=this.appCheckToken);let s=process.env,a=this.connURL.indexOf("wss://")===0?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(o.proxy={origin:a})}this.mySock=new un(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");let r=o.message||o.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");let r=o.message||o.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,o=navigator.userAgent.match(i);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&un!==null&&!n.forceDisallow_}static previouslyFailed(){return xe.isInMemoryStorage||xe.get("previous_websocket_failure")===!0}markConnectionHealthy(){xe.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let o=Bt(i);this.onMessage(o)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(_(this.frames===null,"We already have a frame buffer"),e.length<=6){let i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let o=this.extractFrameCount_(i);o!==null&&this.appendFrame_(o)}}send(e){this.resetKeepAlive();let i=A(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let o=Ir(i,Va);o.length>1&&this.sendString_(String(o.length));for(let r=0;r<o.length;r++)this.sendString_(o[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(za))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),qa=(()=>{class n{static get ALL_TRANSPORTS(){return[Jn,ct]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let i=ct&&ct.isAvailable(),o=i&&!ct.previouslyFailed();if(e.webSocketOnly&&(i||Y("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[ct];else{let r=this.transports_=[];for(let s of n.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Ha=6e4,Ga=5e3,ja=10*1024,$a=100*1024,Bn="t",er="d",Ya="s",tr="r",Ka="e",nr="o",ir="a",or="n",rr="p",Qa="h",ti=class{constructor(t,e,i,o,r,s,a,l,c,d){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=o,this.authToken_=r,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=yt("c:"+this.id+":"),this.transportManager_=new qa(e),this.log_("Connection created"),this.start_()}start_(){let t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));let o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=pt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>$a?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ja?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){let e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Bn in t){let e=t[Bn];e===ir?this.upgradeIfSecondaryHealthy_():e===tr?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===nr&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){let e=lt("t",t),i=lt("d",t);if(e==="c")this.onSecondaryControl_(i);else if(e==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:rr,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ir,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:or,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){let e=lt("t",t),i=lt("d",t);e==="c"?this.onControl_(i):e==="d"&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){let e=lt(Bn,t);if(er in t){let i=t[er];if(e===Qa){let o=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(o.h=this.repoInfo_.host),this.onHandshake_(o)}else if(e===or){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===Ya?this.onConnectionShutdown_(i):e===tr?this.onReset_(i):e===Ka?$n("Server Error: "+i):e===nr?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):$n("Unknown control packet command: "+e)}}onHandshake_(t){let e=t.ts,i=t.v,o=t.h;this.sessionId=t.s,this.repoInfo_.host=o,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),ln!==i&&Y("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),pt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ha))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):pt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ga))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:rr,d:{}}}))}onSecondaryConnectionLost_(){let t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xe.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var dn=class{put(t,e,i,o){}merge(t,e,i,o){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}};var hn=class{constructor(t){this.allowedEvents_=t,this.listeners_={},_(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){let i=[...this.listeners_[t]];for(let o=0;o<i.length;o++)i[o].callback.apply(i[o].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});let o=this.getInitialEvent(t);o&&e.apply(i,o)}off(t,e,i){this.validateEventType_(t);let o=this.listeners_[t]||[];for(let r=0;r<o.length;r++)if(o[r].callback===e&&(!i||i===o[r].context)){o.splice(r,1);return}}validateEventType_(t){_(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}};var pn=class n extends hn{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Rn()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return _(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}};var sr=32,ar=768,T=class{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let i=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}};function S(){return new T("")}function w(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function be(n){return n.pieces_.length-n.pieceNum_}function k(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new T(n.pieces_,t)}function Yr(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Xa(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)n.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}function Kr(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function Qr(n){if(n.pieceNum_>=n.pieces_.length)return null;let t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new T(t,0)}function D(n,t){let e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof T)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{let i=t.split("/");for(let o=0;o<i.length;o++)i[o].length>0&&e.push(i[o])}return new T(e,0)}function y(n){return n.pieceNum_>=n.pieces_.length}function K(n,t){let e=w(n),i=w(t);if(e===null)return t;if(e===i)return K(k(n),k(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Xr(n,t){if(be(n)!==be(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function J(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(be(n)>be(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}var ni=class{constructor(t,e){this.errorPrefix_=e,this.parts_=Kr(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=rt(this.parts_[i]);Zr(this)}};function Za(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=rt(t),Zr(n)}function Ja(n){let t=n.parts_.pop();n.byteLength_-=rt(t),n.parts_.length>0&&(n.byteLength_-=1)}function Zr(n){if(n.byteLength_>ar)throw new Error(n.errorPrefix_+"has a key path longer than "+ar+" bytes ("+n.byteLength_+").");if(n.parts_.length>sr)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+sr+") or object contains a cycle "+we(n))}function we(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var ii=class n extends hn{static getInstance(){return new n}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{let i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(t){return _(t==="visible","Unknown event type: "+t),[this.visible_]}};var ut=1e3,el=60*5*1e3,lr=30*1e3,tl=1.3,nl=3e4,il="server_kill",cr=3,Fi=(()=>{class n extends dn{constructor(e,i,o,r,s,a,l,c){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=o,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=yt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ut,this.maxReconnectDelay_=el,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!se())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ii.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&pn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,o){let r=++this.requestNumber_,s={r,a:e,b:i};this.log_(A(s)),_(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),o&&(this.requestCBHash_[r]=o)}get(e){this.initConnection_();let i=new In,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),i.promise}listen(e,i,o,r){this.initConnection_();let s=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+s),this.listens.has(a)||this.listens.set(a,new Map),_(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_(!this.listens.get(a).has(s),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:e,tag:o};this.listens.get(a).set(s,l),this.connected_&&this.sendListen_(l)}sendGet_(e){let i=this.outstandingGets_[e];this.sendRequest("g",i.request,o=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(o)})}sendListen_(e){let i=e.query,o=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+o+" for "+r);let s={p:o},a="q";e.tag&&(s.q=i._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(a,s,l=>{let c=l.d,d=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(o)&&this.listens.get(o).get(r))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(o,r),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,i){if(e&&typeof e=="object"&&ae(e,"w")){let o=ye(e,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',s=i._path.toString();Y(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Po(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lr)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,i=Eo(e)?"auth":"gauth",o={cred:e};this.authOverride_===null?o.noauth=!0:typeof this.authOverride_=="object"&&(o.authvar=this.authOverride_),this.sendRequest(i,o,r=>{let s=r.s,a=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let i=e.s,o=e.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,o)})}unlisten(e,i){let o=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+o+" "+r),_(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,r)&&this.connected_&&this.sendUnlisten_(o,r,e._queryObject,i)}sendUnlisten_(e,i,o,r){this.log_("Unlisten on "+e+" for "+i);let s={p:e},a="n";r&&(s.q=o,s.t=r),this.sendRequest(a,s)}onDisconnectPut(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:o})}onDisconnectMerge(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:o})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,o,r){let s={p:i,d:o};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(e,i,o,r){this.putInternal("p",e,i,o,r)}merge(e,i,o,r){this.putInternal("m",e,i,o,r)}putInternal(e,i,o,r,s){this.initConnection_();let a={p:i,d:o};s!==void 0&&(a.h=s),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(e){let i=this.outstandingPuts_[e].action,o=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,o,s=>{this.log_(i+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){let i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,o=>{if(o.s!=="ok"){let s=o.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+A(e));let i=e.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),e==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):e==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):e==="c"?this.onListenRevoked_(i.p,i.q):e==="ac"?this.onAuthRevoked_(i.s,i.d):e==="apc"?this.onAppCheckRevoked_(i.s,i.d):e==="sd"?this.onSecurityDebugPacket_(i):$n("Unrecognized action received from server: "+A(e)+`
Are you using the latest client?`)}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){_(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>nl&&(this.reconnectDelay_=ut),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*tl)}this.onConnectStatus_(!1)}establishConnection_(){return G(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,s=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,o())},d=function(m){_(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(m)};this.realtime_={close:c,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,C]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?L("getToken() completed but was canceled"):(L("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=C&&C.token,l=new ti(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,i,o,v=>{Y(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(il)},s))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Y(m),c())}}})}interrupt(e){L("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){L("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Nn(this.interruptReasons_)&&(this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let i=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let o;i?o=i.map(s=>Di(s)).join("$"):o="default";let r=this.removeListen_(e,o);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,i){let o=new T(e).toString(),r;if(this.listens.has(o)){let s=this.listens.get(o);r=s.get(i),s.delete(i),s.size===0&&this.listens.delete(o)}else r=void 0;return r}onAuthRevoked_(e,i){L("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=cr&&(this.reconnectDelay_=lr,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){L("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=cr&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},i="js";se()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),e["sdk."+i+"."+Ai.replace(/\./g,"-")]=1,Rn()?e["framework.cordova"]=1:wo()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=pn.getInstance().currentlyOnline();return Nn(this.interruptReasons_)&&e}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),x=class n{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new n(t,e)}};var $e=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){let i=new x(je,t),o=new x(je,e);return this.compare(i,o)!==0}minPost(){return x.MIN}};var an,fn=class extends $e{static get __EMPTY_NODE(){return an}static set __EMPTY_NODE(t){an=t}compare(t,e){return Je(t.name,e.name)}isDefinedOn(t){throw Be("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return x.MIN}maxPost(){return new x(Pe,an)}makePost(t,e){return _(typeof t=="string","KeyIndex indexValue must always be a string."),new x(t,an)}toString(){return".key"}},Ge=new fn;var ze=class{constructor(t,e,i,o,r=null){this.isReverse_=o,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!t.isEmpty();)if(t=t,s=e?i(t.key,e):1,o&&(s*=-1),s<0)this.isReverse_?t=t.left:t=t.right;else if(s===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}},Z=(()=>{class n{constructor(e,i,o,r,s){this.key=e,this.value=i,this.color=o??n.RED,this.left=r??Q.EMPTY_NODE,this.right=s??Q.EMPTY_NODE}copy(e,i,o,r,s){return new n(e??this.key,i??this.value,o??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let r=this,s=o(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,i,o),null):s===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,i,o)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Q.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let o,r;if(o=this,i(e,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,i),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),i(e,o.key)===0){if(o.right.isEmpty())return Q.EMPTY_NODE;r=o.right.min_(),o=o.copy(r.key,r.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,i))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),oi=class{copy(t,e,i,o,r){return this}insert(t,e,i){return new Z(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Q=class n{constructor(t,e=n.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Z.BLACK,null,null))}remove(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Z.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),e===0)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,o=null;for(;!i.isEmpty();)if(e=this.comparator_(t,i.key),e===0){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else e<0?i=i.left:e>0&&(o=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new ze(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new ze(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new ze(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new ze(this.root_,null,this.comparator_,!0,t)}};Q.EMPTY_NODE=new oi;function ol(n,t){return Je(n.name,t.name)}function Ui(n,t){return Je(n,t)}var ri;function rl(n){ri=n}var Jr=function(n){return typeof n=="number"?"number:"+Rr(n):"string:"+n},es=function(n){if(n.isLeafNode()){let t=n.val();_(typeof t=="string"||typeof t=="number"||typeof t=="object"&&ae(t,".sv"),"Priority must be a string or number.")}else _(n===ri||n.isEmpty(),"priority of unexpected type.");_(n===ri||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var ur,Ye=(()=>{class n{static set __childrenNodeConstructor(e){ur=e}static get __childrenNodeConstructor(){return ur}constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,_(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),es(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return y(e)?this:w(e)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return e===".priority"?this.updatePriority(i):i.isEmpty()&&e!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){let o=w(e);return o===null?i:i.isEmpty()&&o!==".priority"?this:(_(o!==".priority"||be(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(k(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Jr(this.priorityNode_.val())+":");let i=typeof this.value_;e+=i+":",i==="number"?e+=Rr(this.value_):e+=this.value_,this.lazyHash_=kr(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:(_(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let i=typeof e.value_,o=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),s=n.VALUE_TYPE_ORDER.indexOf(o);return _(r>=0,"Unknown leaf type: "+i),_(s>=0,"Unknown leaf type: "+o),r===s?o==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let i=e;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),ts,ns;function sl(n){ts=n}function al(n){ns=n}var si=class extends $e{compare(t,e){let i=t.node.getPriority(),o=e.node.getPriority(),r=i.compareTo(o);return r===0?Je(t.name,e.name):r}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return x.MIN}maxPost(){return new x(Pe,new Ye("[PRIORITY-POST]",ns))}makePost(t,e){let i=ts(t);return new x(e,new Ye("[PRIORITY-POST]",i))}toString(){return".priority"}},U=new si;var ll=Math.log(2),ai=class{constructor(t){let e=r=>parseInt(Math.log(r)/ll,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;let o=i(this.count);this.bits_=t+1&o}nextBitIsOne(){let t=!(this.bits_&1<<this.current_);return this.current_--,t}},mn=function(n,t,e,i){n.sort(t);let o=function(l,c){let d=c-l,p,m;if(d===0)return null;if(d===1)return p=n[l],m=e?e(p):p,new Z(m,p.node,Z.BLACK,null,null);{let C=parseInt(d/2,10)+l,v=o(l,C),O=o(C+1,c);return p=n[C],m=e?e(p):p,new Z(m,p.node,Z.BLACK,v,O)}},r=function(l){let c=null,d=null,p=n.length,m=function(v,O){let M=p-v,_e=p;p-=v;let ke=o(M+1,_e),te=n[M],H=e?e(te):te;C(new Z(H,te.node,O,null,ke))},C=function(v){c?(c.left=v,c=v):(d=v,c=v)};for(let v=0;v<l.count;++v){let O=l.nextBitIsOne(),M=Math.pow(2,l.count-(v+1));O?m(M,Z.BLACK):(m(M,Z.BLACK),m(M,Z.RED))}return d},s=new ai(n.length),a=r(s);return new Q(i||t,a)};var Wn,Ve={},Ke=class n{static get Default(){return _(Ve&&U,"ChildrenNode.ts has not been loaded"),Wn=Wn||new n({".priority":Ve},{".priority":U}),Wn}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){let e=ye(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Q?e:null}hasIndex(t){return ae(this.indexSet_,t.toString())}addIndex(t,e){_(t!==Ge,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],o=!1,r=e.getIterator(x.Wrap),s=r.getNext();for(;s;)o=o||t.isDefinedOn(s.node),i.push(s),s=r.getNext();let a;o?a=mn(i,t.getCompare()):a=Ve;let l=t.toString(),c=Object.assign({},this.indexSet_);c[l]=t;let d=Object.assign({},this.indexes_);return d[l]=a,new n(d,c)}addToIndexes(t,e){let i=ot(this.indexes_,(o,r)=>{let s=ye(this.indexSet_,r);if(_(s,"Missing index implementation for "+r),o===Ve)if(s.isDefinedOn(t.node)){let a=[],l=e.getIterator(x.Wrap),c=l.getNext();for(;c;)c.name!==t.name&&a.push(c),c=l.getNext();return a.push(t),mn(a,s.getCompare())}else return Ve;else{let a=e.get(t.name),l=o;return a&&(l=l.remove(new x(t.name,a))),l.insert(t,t.node)}});return new n(i,this.indexSet_)}removeFromIndexes(t,e){let i=ot(this.indexes_,o=>{if(o===Ve)return o;{let r=e.get(t.name);return r?o.remove(new x(t.name,r)):o}});return new n(i,this.indexSet_)}};var dt,I=(()=>{class n{static get EMPTY_NODE(){return dt||(dt=new n(new Q(Ui),null,Ke.Default))}constructor(e,i,o){this.children_=e,this.priorityNode_=i,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&es(this.priorityNode_),this.children_.isEmpty()&&_(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||dt}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let i=this.children_.get(e);return i===null?dt:i}}getChild(e){let i=w(e);return i===null?this:this.getImmediateChild(i).getChild(k(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,i){if(_(i,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(i);{let o=new x(e,i),r,s;i.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(o,this.children_)):(r=this.children_.insert(e,i),s=this.indexMap_.addToIndexes(o,this.children_));let a=r.isEmpty()?dt:this.priorityNode_;return new n(r,a,s)}}updateChild(e,i){let o=w(e);if(o===null)return i;{_(w(e)!==".priority"||be(e)===1,".priority must be the last token in a path");let r=this.getImmediateChild(o).updateChild(k(e),i);return this.updateImmediateChild(o,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let i={},o=0,r=0,s=!0;if(this.forEachChild(U,(a,l)=>{i[a]=l.val(e),o++,s&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):s=!1}),!e&&s&&r<2*o){let a=[];for(let l in i)a[l]=i[l];return a}else return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Jr(this.getPriority().val())+":"),this.forEachChild(U,(i,o)=>{let r=o.hash();r!==""&&(e+=":"+i+":"+r)}),this.lazyHash_=e===""?"":kr(e)}return this.lazyHash_}getPredecessorChildName(e,i,o){let r=this.resolveIndex_(o);if(r){let s=r.getPredecessorKey(new x(e,i));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let i=this.resolveIndex_(e);if(i){let o=i.minKey();return o&&o.name}else return this.children_.minKey()}getFirstChild(e){let i=this.getFirstChildName(e);return i?new x(i,this.children_.get(i)):null}getLastChildName(e){let i=this.resolveIndex_(e);if(i){let o=i.maxKey();return o&&o.name}else return this.children_.maxKey()}getLastChild(e){let i=this.getLastChildName(e);return i?new x(i,this.children_.get(i)):null}forEachChild(e,i){let o=this.resolveIndex_(e);return o?o.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){let o=this.resolveIndex_(i);if(o)return o.getIteratorFrom(e,r=>r);{let r=this.children_.getIteratorFrom(e.name,x.Wrap),s=r.peek();for(;s!=null&&i.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){let o=this.resolveIndex_(i);if(o)return o.getReverseIteratorFrom(e,r=>r);{let r=this.children_.getReverseIteratorFrom(e.name,x.Wrap),s=r.peek();for(;s!=null&&i.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===xt?-1:0}withIndex(e){if(e===Ge||this.indexMap_.hasIndex(e))return this;{let i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Ge||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let i=e;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let o=this.getIterator(U),r=i.getIterator(U),s=o.getNext(),a=r.getNext();for(;s&&a;){if(s.name!==a.name||!s.node.equals(a.node))return!1;s=o.getNext(),a=r.getNext()}return s===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Ge?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),li=class extends I{constructor(){super(new Q(Ui),I.EMPTY_NODE,Ke.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return I.EMPTY_NODE}isEmpty(){return!1}},xt=new li;Object.defineProperties(x,{MIN:{value:new x(je,I.EMPTY_NODE)},MAX:{value:new x(Pe,xt)}});fn.__EMPTY_NODE=I.EMPTY_NODE;Ye.__childrenNodeConstructor=I;rl(xt);al(xt);var cl=!0;function F(n,t=null){if(n===null)return I.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(t=n[".priority"]),_(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let e=n;return new Ye(e,F(t))}if(!(n instanceof Array)&&cl){let e=[],i=!1;if(X(n,(s,a)=>{if(s.substring(0,1)!=="."){let l=F(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),e.push(new x(s,l)))}}),e.length===0)return I.EMPTY_NODE;let r=mn(e,ol,s=>s.name,Ui);if(i){let s=mn(e,U.getCompare());return new I(r,F(t),new Ke({".priority":s},{".priority":U}))}else return new I(r,F(t),Ke.Default)}else{let e=I.EMPTY_NODE;return X(n,(i,o)=>{if(ae(n,i)&&i.substring(0,1)!=="."){let r=F(o);(r.isLeafNode()||!r.isEmpty())&&(e=e.updateImmediateChild(i,r))}}),e.updatePriority(F(t))}}sl(F);var ci=class extends $e{constructor(t){super(),this.indexPath_=t,_(!y(t)&&w(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){let i=this.extractChild(t.node),o=this.extractChild(e.node),r=i.compareTo(o);return r===0?Je(t.name,e.name):r}makePost(t,e){let i=F(t),o=I.EMPTY_NODE.updateChild(this.indexPath_,i);return new x(e,o)}maxPost(){let t=I.EMPTY_NODE.updateChild(this.indexPath_,xt);return new x(Pe,t)}toString(){return Kr(this.indexPath_,0).join("/")}};var ui=class extends $e{compare(t,e){let i=t.node.compareTo(e.node);return i===0?Je(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return x.MIN}maxPost(){return x.MAX}makePost(t,e){let i=F(t);return new x(e,i)}toString(){return".value"}},ul=new ui;function dl(n){return{type:"value",snapshotNode:n}}function hl(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function pl(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function dr(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}function fl(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}var di=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=U}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:je}hasEnd(){return this.endSet_}getIndexEndValue(){return _(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Pe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===U}copy(){let t=new n;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function hr(n){let t={};if(n.isDefault())return t;let e;if(n.index_===U?e="$priority":n.index_===ul?e="$value":n.index_===Ge?e="$key":(_(n.index_ instanceof ci,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=A(e),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";t[i]=A(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+A(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";t[i]=A(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+A(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function pr(n){let t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;e===""&&(n.isViewFromLeft()?e="l":e="r"),t.vf=e}return n.index_!==U&&(t.i=n.index_.toString()),t}var hi=class n extends dn{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(_(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,i,o){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.log_=yt("p:rest:"),this.listens_={}}listen(t,e,i,o){let r=t._path.toString();this.log_("Listen called for "+r+" "+t._queryIdentifier);let s=n.getListenId_(t,i),a={};this.listens_[s]=a;let l=hr(t._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let p=d;if(c===404&&(p=null,c=null),c===null&&this.onDataUpdate_(r,p,!1,i),ye(this.listens_,s)===a){let m;c?c===401?m="permission_denied":m="rest_error:"+c:m="ok",o(m,null)}})}unlisten(t,e){let i=n.getListenId_(t,e);delete this.listens_[i]}get(t){let e=hr(t._queryParams),i=t._path.toString(),o=new In;return this.restRequest_(i+".json",e,(r,s)=>{let a=s;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),o.resolve(a)):o.reject(new Error(a))}),o.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,r])=>{o&&o.accessToken&&(e.auth=o.accessToken),r&&r.token&&(e.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+To(e);this.log_("Sending REST request for "+s);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Bt(a.responseText)}catch{Y("Failed to parse JSON response for "+s+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&Y("Got unsuccessful REST response for "+s+" Status: "+a.status),i(a.status);i=null}},a.open("GET",s,!0),a.send()})}};var pi=class{constructor(){this.rootNode_=I.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}};function _n(){return{value:null,children:new Map}}function is(n,t,e){if(y(t))n.value=e,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(t,e);else{let i=w(t);n.children.has(i)||n.children.set(i,_n());let o=n.children.get(i);t=k(t),is(o,t,e)}}function fi(n,t,e){n.value!==null?e(t,n.value):ml(n,(i,o)=>{let r=new T(t.toString()+"/"+i);fi(o,r,e)})}function ml(n,t){n.children.forEach((e,i)=>{t(i,e)})}var mi=class{constructor(t){this.collection_=t,this.last_=null}get(){let t=this.collection_.get(),e=Object.assign({},t);return this.last_&&X(this.last_,(i,o)=>{e[i]=e[i]-o}),this.last_=t,e}};var fr=10*1e3,_l=30*1e3,gl=5*60*1e3,_i=class{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new mi(t);let i=fr+(_l-fr)*Math.random();pt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let t=this.statsListener_.get(),e={},i=!1;X(t,(o,r)=>{r>0&&ae(this.statsToReport_,o)&&(e[o]=r,i=!0)}),i&&this.server_.reportStats(e),pt(this.reportStats_.bind(this),Math.floor(Math.random()*2*gl))}};var he=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(he||{});function os(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ss(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var gi=class n{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=he.ACK_USER_WRITE,this.source=os()}operationForChild(t){if(y(this.path)){if(this.affectedTree.value!=null)return _(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let e=this.affectedTree.subtree(new T(t));return new n(S(),e,this.revert)}}else return _(w(this.path)===t,"operationForChild called for unrelated child."),new n(k(this.path),this.affectedTree,this.revert)}};var Qe=class n{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=he.OVERWRITE}operationForChild(t){return y(this.path)?new n(this.source,S(),this.snap.getImmediateChild(t)):new n(this.source,k(this.path),this.snap)}};var gn=class n{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=he.MERGE}operationForChild(t){if(y(this.path)){let e=this.children.subtree(new T(t));return e.isEmpty()?null:e.value?new Qe(this.source,S(),e.value):new n(this.source,S(),e)}else return _(w(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,k(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var gt=class{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(y(t))return this.isFullyInitialized()&&!this.filtered_;let e=w(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}};function vl(n,t,e,i){let o=[],r=[];return t.forEach(s=>{s.type==="child_changed"&&n.index_.indexedValueChanged(s.oldSnap,s.snapshotNode)&&r.push(fl(s.childName,s.snapshotNode))}),ht(n,o,"child_removed",t,i,e),ht(n,o,"child_added",t,i,e),ht(n,o,"child_moved",r,i,e),ht(n,o,"child_changed",t,i,e),ht(n,o,"value",t,i,e),o}function ht(n,t,e,i,o,r){let s=i.filter(a=>a.type===e);s.sort((a,l)=>bl(n,a,l)),s.forEach(a=>{let l=Cl(n,a,r);o.forEach(c=>{c.respondsTo(a.type)&&t.push(c.createEvent(l,n.query_))})})}function Cl(n,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}function bl(n,t,e){if(t.childName==null||e.childName==null)throw Be("Should only compare child_ events.");let i=new x(t.childName,t.snapshotNode),o=new x(e.childName,e.snapshotNode);return n.index_.compare(i,o)}function as(n,t){return{eventCache:n,serverCache:t}}function mt(n,t,e,i){return as(new gt(t,e,i),n.serverCache)}function ls(n,t,e,i){return as(n.eventCache,new gt(t,e,i))}function vi(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Se(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Vn,yl=()=>(Vn||(Vn=new Q(ya)),Vn),q=class n{static fromObject(t){let e=new n(null);return X(t,(i,o)=>{e=e.set(new T(i),o)}),e}constructor(t,e=yl()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:S(),value:this.value};if(y(t))return null;{let i=w(t),o=this.children.get(i);if(o!==null){let r=o.findRootMostMatchingPathAndValue(k(t),e);return r!=null?{path:D(new T(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(y(t))return this;{let e=w(t),i=this.children.get(e);return i!==null?i.subtree(k(t)):new n(null)}}set(t,e){if(y(t))return new n(e,this.children);{let i=w(t),r=(this.children.get(i)||new n(null)).set(k(t),e),s=this.children.insert(i,r);return new n(this.value,s)}}remove(t){if(y(t))return this.children.isEmpty()?new n(null):new n(null,this.children);{let e=w(t),i=this.children.get(e);if(i){let o=i.remove(k(t)),r;return o.isEmpty()?r=this.children.remove(e):r=this.children.insert(e,o),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(t){if(y(t))return this.value;{let e=w(t),i=this.children.get(e);return i?i.get(k(t)):null}}setTree(t,e){if(y(t))return e;{let i=w(t),r=(this.children.get(i)||new n(null)).setTree(k(t),e),s;return r.isEmpty()?s=this.children.remove(i):s=this.children.insert(i,r),new n(this.value,s)}}fold(t){return this.fold_(S(),t)}fold_(t,e){let i={};return this.children.inorderTraversal((o,r)=>{i[o]=r.fold_(D(t,o),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,S(),e)}findOnPath_(t,e,i){let o=this.value?i(e,this.value):!1;if(o)return o;if(y(t))return null;{let r=w(t),s=this.children.get(r);return s?s.findOnPath_(k(t),D(e,r),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,S(),e)}foreachOnPath_(t,e,i){if(y(t))return this;{this.value&&i(e,this.value);let o=w(t),r=this.children.get(o);return r?r.foreachOnPath_(k(t),D(e,o),i):new n(null)}}foreach(t){this.foreach_(S(),t)}foreach_(t,e){this.children.inorderTraversal((i,o)=>{o.foreach_(D(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}};var ee=class n{constructor(t){this.writeTree_=t}static empty(){return new n(new q(null))}};function _t(n,t,e){if(y(t))return new ee(new q(e));{let i=n.writeTree_.findRootMostValueAndPath(t);if(i!=null){let o=i.path,r=i.value,s=K(o,t);return r=r.updateChild(s,e),new ee(n.writeTree_.set(o,r))}else{let o=new q(e),r=n.writeTree_.setTree(t,o);return new ee(r)}}}function mr(n,t,e){let i=n;return X(e,(o,r)=>{i=_t(i,D(t,o),r)}),i}function _r(n,t){if(y(t))return ee.empty();{let e=n.writeTree_.setTree(t,new q(null));return new ee(e)}}function Ci(n,t){return Te(n,t)!=null}function Te(n,t){let e=n.writeTree_.findRootMostValueAndPath(t);return e!=null?n.writeTree_.get(e.path).getChild(K(e.path,t)):null}function gr(n){let t=[],e=n.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(U,(i,o)=>{t.push(new x(i,o))}):n.writeTree_.children.inorderTraversal((i,o)=>{o.value!=null&&t.push(new x(i,o.value))}),t}function Ce(n,t){if(y(t))return n;{let e=Te(n,t);return e!=null?new ee(new q(e)):new ee(n.writeTree_.subtree(t))}}function bi(n){return n.writeTree_.isEmpty()}function Xe(n,t){return cs(S(),n.writeTree_,t)}function cs(n,t,e){if(t.value!=null)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((o,r)=>{o===".priority"?(_(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):e=cs(D(n,o),r,e)}),!e.getChild(n).isEmpty()&&i!==null&&(e=e.updateChild(D(n,".priority"),i)),e}}function us(n,t){return ms(t,n)}function wl(n,t,e,i,o){_(i>n.lastWriteId,"Stacking an older write on top of newer ones"),o===void 0&&(o=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:o}),o&&(n.visibleWrites=_t(n.visibleWrites,t,e)),n.lastWriteId=i}function xl(n,t){for(let e=0;e<n.allWrites.length;e++){let i=n.allWrites[e];if(i.writeId===t)return i}return null}function El(n,t){let e=n.allWrites.findIndex(a=>a.writeId===t);_(e>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[e];n.allWrites.splice(e,1);let o=i.visible,r=!1,s=n.allWrites.length-1;for(;o&&s>=0;){let a=n.allWrites[s];a.visible&&(s>=e&&Pl(a,i.path)?o=!1:J(i.path,a.path)&&(r=!0)),s--}if(o){if(r)return Sl(n),!0;if(i.snap)n.visibleWrites=_r(n.visibleWrites,i.path);else{let a=i.children;X(a,l=>{n.visibleWrites=_r(n.visibleWrites,D(i.path,l))})}return!0}else return!1}function Pl(n,t){if(n.snap)return J(n.path,t);for(let e in n.children)if(n.children.hasOwnProperty(e)&&J(D(n.path,e),t))return!0;return!1}function Sl(n){n.visibleWrites=ds(n.allWrites,Tl,S()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Tl(n){return n.visible}function ds(n,t,e){let i=ee.empty();for(let o=0;o<n.length;++o){let r=n[o];if(t(r)){let s=r.path,a;if(r.snap)J(e,s)?(a=K(e,s),i=_t(i,a,r.snap)):J(s,e)&&(a=K(s,e),i=_t(i,S(),r.snap.getChild(a)));else if(r.children){if(J(e,s))a=K(e,s),i=mr(i,a,r.children);else if(J(s,e))if(a=K(s,e),y(a))i=mr(i,S(),r.children);else{let l=ye(r.children,w(a));if(l){let c=l.getChild(k(a));i=_t(i,S(),c)}}}else throw Be("WriteRecord should have .snap or .children")}}return i}function hs(n,t,e,i,o){if(!i&&!o){let r=Te(n.visibleWrites,t);if(r!=null)return r;{let s=Ce(n.visibleWrites,t);if(bi(s))return e;if(e==null&&!Ci(s,S()))return null;{let a=e||I.EMPTY_NODE;return Xe(s,a)}}}else{let r=Ce(n.visibleWrites,t);if(!o&&bi(r))return e;if(!o&&e==null&&!Ci(r,S()))return null;{let s=function(c){return(c.visible||o)&&(!i||!~i.indexOf(c.writeId))&&(J(c.path,t)||J(t,c.path))},a=ds(n.allWrites,s,t),l=e||I.EMPTY_NODE;return Xe(a,l)}}}function Ml(n,t,e){let i=I.EMPTY_NODE,o=Te(n.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(U,(r,s)=>{i=i.updateImmediateChild(r,s)}),i;if(e){let r=Ce(n.visibleWrites,t);return e.forEachChild(U,(s,a)=>{let l=Xe(Ce(r,new T(s)),a);i=i.updateImmediateChild(s,l)}),gr(r).forEach(s=>{i=i.updateImmediateChild(s.name,s.node)}),i}else{let r=Ce(n.visibleWrites,t);return gr(r).forEach(s=>{i=i.updateImmediateChild(s.name,s.node)}),i}}function kl(n,t,e,i,o){_(i||o,"Either existingEventSnap or existingServerSnap must exist");let r=D(t,e);if(Ci(n.visibleWrites,r))return null;{let s=Ce(n.visibleWrites,r);return bi(s)?o.getChild(e):Xe(s,o.getChild(e))}}function Ol(n,t,e,i){let o=D(t,e),r=Te(n.visibleWrites,o);if(r!=null)return r;if(i.isCompleteForChild(e)){let s=Ce(n.visibleWrites,o);return Xe(s,i.getNode().getImmediateChild(e))}else return null}function Il(n,t){return Te(n.visibleWrites,t)}function Rl(n,t,e,i,o,r,s){let a,l=Ce(n.visibleWrites,t),c=Te(l,S());if(c!=null)a=c;else if(e!=null)a=Xe(l,e);else return[];if(a=a.withIndex(s),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=s.getCompare(),m=r?a.getReverseIteratorFrom(i,s):a.getIteratorFrom(i,s),C=m.getNext();for(;C&&d.length<o;)p(C,i)!==0&&d.push(C),C=m.getNext();return d}else return[]}function Nl(){return{visibleWrites:ee.empty(),allWrites:[],lastWriteId:-1}}function yi(n,t,e,i){return hs(n.writeTree,n.treePath,t,e,i)}function ps(n,t){return Ml(n.writeTree,n.treePath,t)}function vr(n,t,e,i){return kl(n.writeTree,n.treePath,t,e,i)}function vn(n,t){return Il(n.writeTree,D(n.treePath,t))}function Al(n,t,e,i,o,r){return Rl(n.writeTree,n.treePath,t,e,i,o,r)}function Bi(n,t,e){return Ol(n.writeTree,n.treePath,t,e)}function fs(n,t){return ms(D(n.treePath,t),n.writeTree)}function ms(n,t){return{treePath:n,writeTree:t}}var wi=class{constructor(){this.changeMap=new Map}trackChildChange(t){let e=t.type,i=t.childName;_(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),_(i!==".priority","Only non-priority child changes can be tracked.");let o=this.changeMap.get(i);if(o){let r=o.type;if(e==="child_added"&&r==="child_removed")this.changeMap.set(i,dr(i,t.snapshotNode,o.snapshotNode));else if(e==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(e==="child_removed"&&r==="child_changed")this.changeMap.set(i,pl(i,o.oldSnap));else if(e==="child_changed"&&r==="child_added")this.changeMap.set(i,hl(i,t.snapshotNode));else if(e==="child_changed"&&r==="child_changed")this.changeMap.set(i,dr(i,t.snapshotNode,o.oldSnap));else throw Be("Illegal combination of changes: "+t+" occurred after "+o)}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}};var xi=class{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}},_s=new xi,vt=class{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){let e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{let i=this.optCompleteServerCache_!=null?new gt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Bi(this.writes_,t,i)}}getChildAfterChild(t,e,i){let o=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Se(this.viewCache_),r=Al(this.writes_,o,e,1,i,t);return r.length===0?null:r[0]}};function Dl(n,t){_(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Ll(n,t,e,i,o){let r=new wi,s,a;if(e.type===he.OVERWRITE){let c=e;c.source.fromUser?s=Ei(n,t,c.path,c.snap,i,o,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!y(c.path),s=Cn(n,t,c.path,c.snap,i,o,a,r))}else if(e.type===he.MERGE){let c=e;c.source.fromUser?s=Ul(n,t,c.path,c.children,i,o,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),s=Pi(n,t,c.path,c.children,i,o,a,r))}else if(e.type===he.ACK_USER_WRITE){let c=e;c.revert?s=Vl(n,t,c.path,i,o,r):s=Bl(n,t,c.path,c.affectedTree,i,o,r)}else if(e.type===he.LISTEN_COMPLETE)s=Wl(n,t,e.path,i,r);else throw Be("Unknown operation type: "+e.type);let l=r.getChanges();return Fl(t,s,l),{viewCache:s,changes:l}}function Fl(n,t,e){let i=t.eventCache;if(i.isFullyInitialized()){let o=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=vi(n);(e.length>0||!n.eventCache.isFullyInitialized()||o&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&e.push(dl(vi(t)))}}function gs(n,t,e,i,o,r){let s=t.eventCache;if(vn(i,e)!=null)return t;{let a,l;if(y(e))if(_(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let c=Se(t),d=c instanceof I?c:I.EMPTY_NODE,p=ps(i,d);a=n.filter.updateFullNode(t.eventCache.getNode(),p,r)}else{let c=yi(i,Se(t));a=n.filter.updateFullNode(t.eventCache.getNode(),c,r)}else{let c=w(e);if(c===".priority"){_(be(e)===1,"Can't have a priority with additional path components");let d=s.getNode();l=t.serverCache.getNode();let p=vr(i,e,d,l);p!=null?a=n.filter.updatePriority(d,p):a=s.getNode()}else{let d=k(e),p;if(s.isCompleteForChild(c)){l=t.serverCache.getNode();let m=vr(i,e,s.getNode(),l);m!=null?p=s.getNode().getImmediateChild(c).updateChild(d,m):p=s.getNode().getImmediateChild(c)}else p=Bi(i,c,t.serverCache);p!=null?a=n.filter.updateChild(s.getNode(),c,p,d,o,r):a=s.getNode()}}return mt(t,a,s.isFullyInitialized()||y(e),n.filter.filtersNodes())}}function Cn(n,t,e,i,o,r,s,a){let l=t.serverCache,c,d=s?n.filter:n.filter.getIndexedFilter();if(y(e))c=d.updateFullNode(l.getNode(),i,null);else if(d.filtersNodes()&&!l.isFiltered()){let C=l.getNode().updateChild(e,i);c=d.updateFullNode(l.getNode(),C,null)}else{let C=w(e);if(!l.isCompleteForPath(e)&&be(e)>1)return t;let v=k(e),M=l.getNode().getImmediateChild(C).updateChild(v,i);C===".priority"?c=d.updatePriority(l.getNode(),M):c=d.updateChild(l.getNode(),C,M,v,_s,null)}let p=ls(t,c,l.isFullyInitialized()||y(e),d.filtersNodes()),m=new vt(o,p,r);return gs(n,p,e,o,m,a)}function Ei(n,t,e,i,o,r,s){let a=t.eventCache,l,c,d=new vt(o,t,r);if(y(e))c=n.filter.updateFullNode(t.eventCache.getNode(),i,s),l=mt(t,c,!0,n.filter.filtersNodes());else{let p=w(e);if(p===".priority")c=n.filter.updatePriority(t.eventCache.getNode(),i),l=mt(t,c,a.isFullyInitialized(),a.isFiltered());else{let m=k(e),C=a.getNode().getImmediateChild(p),v;if(y(m))v=i;else{let O=d.getCompleteChild(p);O!=null?Yr(m)===".priority"&&O.getChild(Qr(m)).isEmpty()?v=O:v=O.updateChild(m,i):v=I.EMPTY_NODE}if(C.equals(v))l=t;else{let O=n.filter.updateChild(a.getNode(),p,v,m,d,s);l=mt(t,O,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Cr(n,t){return n.eventCache.isCompleteForChild(t)}function Ul(n,t,e,i,o,r,s){let a=t;return i.foreach((l,c)=>{let d=D(e,l);Cr(t,w(d))&&(a=Ei(n,a,d,c,o,r,s))}),i.foreach((l,c)=>{let d=D(e,l);Cr(t,w(d))||(a=Ei(n,a,d,c,o,r,s))}),a}function br(n,t,e){return e.foreach((i,o)=>{t=t.updateChild(i,o)}),t}function Pi(n,t,e,i,o,r,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l=t,c;y(e)?c=i:c=new q(null).setTree(e,i);let d=t.serverCache.getNode();return c.children.inorderTraversal((p,m)=>{if(d.hasChild(p)){let C=t.serverCache.getNode().getImmediateChild(p),v=br(n,C,m);l=Cn(n,l,new T(p),v,o,r,s,a)}}),c.children.inorderTraversal((p,m)=>{let C=!t.serverCache.isCompleteForChild(p)&&m.value===null;if(!d.hasChild(p)&&!C){let v=t.serverCache.getNode().getImmediateChild(p),O=br(n,v,m);l=Cn(n,l,new T(p),O,o,r,s,a)}}),l}function Bl(n,t,e,i,o,r,s){if(vn(o,e)!=null)return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(i.value!=null){if(y(e)&&l.isFullyInitialized()||l.isCompleteForPath(e))return Cn(n,t,e,l.getNode().getChild(e),o,r,a,s);if(y(e)){let c=new q(null);return l.getNode().forEachChild(Ge,(d,p)=>{c=c.set(new T(d),p)}),Pi(n,t,e,c,o,r,a,s)}else return t}else{let c=new q(null);return i.foreach((d,p)=>{let m=D(e,d);l.isCompleteForPath(m)&&(c=c.set(d,l.getNode().getChild(m)))}),Pi(n,t,e,c,o,r,a,s)}}function Wl(n,t,e,i,o){let r=t.serverCache,s=ls(t,r.getNode(),r.isFullyInitialized()||y(e),r.isFiltered());return gs(n,s,e,i,_s,o)}function Vl(n,t,e,i,o,r){let s;if(vn(i,e)!=null)return t;{let a=new vt(i,t,o),l=t.eventCache.getNode(),c;if(y(e)||w(e)===".priority"){let d;if(t.serverCache.isFullyInitialized())d=yi(i,Se(t));else{let p=t.serverCache.getNode();_(p instanceof I,"serverChildren would be complete if leaf node"),d=ps(i,p)}d=d,c=n.filter.updateFullNode(l,d,r)}else{let d=w(e),p=Bi(i,d,t.serverCache);p==null&&t.serverCache.isCompleteForChild(d)&&(p=l.getImmediateChild(d)),p!=null?c=n.filter.updateChild(l,d,p,k(e),a,r):t.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(l,d,I.EMPTY_NODE,k(e),a,r):c=l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(s=yi(i,Se(t)),s.isLeafNode()&&(c=n.filter.updateFullNode(c,s,r)))}return s=t.serverCache.isFullyInitialized()||vn(i,S())!=null,mt(t,c,s,n.filter.filtersNodes())}}function zl(n,t){let e=Se(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!y(t)&&!e.getImmediateChild(w(t)).isEmpty())?e.getChild(t):null}function yr(n,t,e,i){t.type===he.MERGE&&t.source.queryId!==null&&(_(Se(n.viewCache_),"We should always have a full cache before handling merges"),_(vi(n.viewCache_),"Missing event cache, even though we have a server cache"));let o=n.viewCache_,r=Ll(n.processor_,o,t,e,i);return Dl(n.processor_,r.viewCache),_(r.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,ql(n,r.changes,r.viewCache.eventCache.getNode(),null)}function ql(n,t,e,i){let o=i?[i]:n.eventRegistrations_;return vl(n.eventGenerator_,t,e,o)}var wr;function Hl(n){_(!wr,"__referenceConstructor has already been defined"),wr=n}function Wi(n,t,e,i){let o=t.source.queryId;if(o!==null){let r=n.views.get(o);return _(r!=null,"SyncTree gave us an op for an invalid query."),yr(r,t,e,i)}else{let r=[];for(let s of n.views.values())r=r.concat(yr(s,t,e,i));return r}}function Vi(n,t){let e=null;for(let i of n.views.values())e=e||zl(i,t);return e}var xr;function Gl(n){_(!xr,"__referenceConstructor has already been defined"),xr=n}var bn=class{constructor(t){this.listenProvider_=t,this.syncPointTree_=new q(null),this.pendingWriteTree_=Nl(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function jl(n,t,e,i,o){return wl(n.pendingWriteTree_,t,e,i,o),o?wn(n,new Qe(os(),t,e)):[]}function qe(n,t,e=!1){let i=xl(n.pendingWriteTree_,t);if(El(n.pendingWriteTree_,t)){let r=new q(null);return i.snap!=null?r=r.set(S(),!0):X(i.children,s=>{r=r.set(new T(s),!0)}),wn(n,new gi(i.path,r,e))}else return[]}function yn(n,t,e){return wn(n,new Qe(rs(),t,e))}function $l(n,t,e){let i=q.fromObject(e);return wn(n,new gn(rs(),t,i))}function Yl(n,t,e,i){let o=ys(n,i);if(o!=null){let r=ws(o),s=r.path,a=r.queryId,l=K(s,t),c=new Qe(ss(a),l,e);return xs(n,s,c)}else return[]}function Kl(n,t,e,i){let o=ys(n,i);if(o){let r=ws(o),s=r.path,a=r.queryId,l=K(s,t),c=q.fromObject(e),d=new gn(ss(a),l,c);return xs(n,s,d)}else return[]}function vs(n,t,e){let o=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(t,(s,a)=>{let l=K(s,t),c=Vi(a,l);if(c)return c});return hs(o,t,r,e,!0)}function wn(n,t){return Cs(t,n.syncPointTree_,null,us(n.pendingWriteTree_,S()))}function Cs(n,t,e,i){if(y(n.path))return bs(n,t,e,i);{let o=t.get(S());e==null&&o!=null&&(e=Vi(o,S()));let r=[],s=w(n.path),a=n.operationForChild(s),l=t.children.get(s);if(l&&a){let c=e?e.getImmediateChild(s):null,d=fs(i,s);r=r.concat(Cs(a,l,c,d))}return o&&(r=r.concat(Wi(o,n,i,e))),r}}function bs(n,t,e,i){let o=t.get(S());e==null&&o!=null&&(e=Vi(o,S()));let r=[];return t.children.inorderTraversal((s,a)=>{let l=e?e.getImmediateChild(s):null,c=fs(i,s),d=n.operationForChild(s);d&&(r=r.concat(bs(d,a,l,c)))}),o&&(r=r.concat(Wi(o,n,i,e))),r}function ys(n,t){return n.tagToQueryMap.get(t)}function ws(n){let t=n.indexOf("$");return _(t!==-1&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new T(n.substr(0,t))}}function xs(n,t,e){let i=n.syncPointTree_.get(t);_(i,"Missing sync point for query tag that we're tracking");let o=us(n.pendingWriteTree_,t);return Wi(i,e,o,null)}var Si=class n{constructor(t){this.node_=t}getImmediateChild(t){let e=this.node_.getImmediateChild(t);return new n(e)}node(){return this.node_}},Ti=class n{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){let e=D(this.path_,t);return new n(this.syncTree_,e)}node(){return vs(this.syncTree_,this.path_)}},Ql=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Er=function(n,t,e){if(!n||typeof n!="object")return n;if(_(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Xl(n[".sv"],t,e);if(typeof n[".sv"]=="object")return Zl(n[".sv"],t);_(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Xl=function(n,t,e){switch(n){case"timestamp":return e.timestamp;default:_(!1,"Unexpected server value: "+n)}},Zl=function(n,t,e){n.hasOwnProperty("increment")||_(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&_(!1,"Unexpected increment value: "+i);let o=t.node();if(_(o!==null&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;let s=o.getValue();return typeof s!="number"?i:s+i},Jl=function(n,t,e,i){return zi(t,new Ti(e,n),i)},ec=function(n,t,e){return zi(n,new Si(t),e)};function zi(n,t,e){let i=n.getPriority().val(),o=Er(i,t.getImmediateChild(".priority"),e),r;if(n.isLeafNode()){let s=n,a=Er(s.getValue(),t,e);return a!==s.getValue()||o!==s.getPriority().val()?new Ye(a,F(o)):n}else{let s=n;return r=s,o!==s.getPriority().val()&&(r=r.updatePriority(new Ye(o))),s.forEachChild(U,(a,l)=>{let c=zi(l,t.getImmediateChild(a),e);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Ct=class{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}};function qi(n,t){let e=t instanceof T?t:new T(t),i=n,o=w(e);for(;o!==null;){let r=ye(i.node.children,o)||{children:{},childCount:0};i=new Ct(o,i,r),e=k(e),o=w(e)}return i}function et(n){return n.node.value}function Es(n,t){n.node.value=t,Mi(n)}function Ps(n){return n.node.childCount>0}function tc(n){return et(n)===void 0&&!Ps(n)}function xn(n,t){X(n.node.children,(e,i)=>{t(new Ct(e,n,i))})}function Ss(n,t,e,i){e&&!i&&t(n),xn(n,o=>{Ss(o,t,!0,i)}),e&&i&&t(n)}function nc(n,t,e){let i=e?n:n.parent;for(;i!==null;){if(t(i))return!0;i=i.parent}return!1}function Et(n){return new T(n.parent===null?n.name:Et(n.parent)+"/"+n.name)}function Mi(n){n.parent!==null&&ic(n.parent,n.name,n)}function ic(n,t,e){let i=tc(e),o=ae(n.node.children,t);i&&o?(delete n.node.children[t],n.node.childCount--,Mi(n)):!i&&!o&&(n.node.children[t]=e.node,n.node.childCount++,Mi(n))}var oc=/[\[\].#$\/\u0000-\u001F\u007F]/,rc=/[\[\].#$\u0000-\u001F\u007F]/,zn=10*1024*1024,Ts=function(n){return typeof n=="string"&&n.length!==0&&!oc.test(n)},sc=function(n){return typeof n=="string"&&n.length!==0&&!rc.test(n)},ac=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),sc(n)};var Ms=function(n,t,e){let i=e instanceof T?new ni(e,n):e;if(t===void 0)throw new Error(n+"contains undefined "+we(i));if(typeof t=="function")throw new Error(n+"contains a function "+we(i)+" with contents = "+t.toString());if(Or(t))throw new Error(n+"contains "+t.toString()+" "+we(i));if(typeof t=="string"&&t.length>zn/3&&rt(t)>zn)throw new Error(n+"contains a string greater than "+zn+" utf8 bytes "+we(i)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let o=!1,r=!1;if(X(t,(s,a)=>{if(s===".value")o=!0;else if(s!==".priority"&&s!==".sv"&&(r=!0,!Ts(s)))throw new Error(n+" contains an invalid key ("+s+") "+we(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Za(i,s),Ms(n,a,i),Ja(i)}),o&&r)throw new Error(n+' contains ".value" child '+we(i)+" in addition to actual children.")}};var lc=function(n,t){let e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Ts(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!ac(e))throw new Error(ko(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var ki=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function cc(n,t){let e=null;for(let i=0;i<t.length;i++){let o=t[i],r=o.getPath();e!==null&&!Xr(r,e.path)&&(n.eventLists_.push(e),e=null),e===null&&(e={events:[],path:r}),e.events.push(o)}e&&n.eventLists_.push(e)}function Me(n,t,e){cc(n,e),uc(n,i=>J(i,t)||J(t,i))}function uc(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){let o=n.eventLists_[i];if(o){let r=o.path;t(r)?(dc(n.eventLists_[i]),n.eventLists_[i]=null):e=!1}}e&&(n.eventLists_=[]),n.recursionDepth_--}function dc(n){for(let t=0;t<n.events.length;t++){let e=n.events[t];if(e!==null){n.events[t]=null;let i=e.getEventRunner();Ee&&L("event: "+e.toString()),wt(i)}}}var hc="repo_interrupt",pc=25,Oi=class{constructor(t,e,i,o){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ki,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=_n(),this.transactionQueueTree_=new Ct,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function fc(n,t,e){if(n.stats_=Li(n.repoInfo_),n.forceRestClient_||Ta())n.server_=new hi(n.repoInfo_,(i,o,r,s)=>{Pr(n,i,o,r,s)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Sr(n,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{A(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Fi(n.repoInfo_,t,(i,o,r,s)=>{Pr(n,i,o,r,s)},i=>{Sr(n,i)},i=>{_c(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=ka(n.repoInfo_,()=>new _i(n.stats_,n.server_)),n.infoData_=new pi,n.infoSyncTree_=new bn({startListening:(i,o,r,s)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=yn(n.infoSyncTree_,i._path,l),setTimeout(()=>{s("ok")},0)),a},stopListening:()=>{}}),Hi(n,"connected",!1),n.serverSyncTree_=new bn({startListening:(i,o,r,s)=>(n.server_.listen(i,r,o,(a,l)=>{let c=s(a,l);Me(n.eventQueue_,i._path,c)}),[]),stopListening:(i,o)=>{n.server_.unlisten(i,o)}})}function mc(n){let e=n.infoData_.getNode(new T(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function ks(n){return Ql({timestamp:mc(n)})}function Pr(n,t,e,i,o){n.dataUpdateCount++;let r=new T(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let s=[];if(o)if(i){let l=ot(e,c=>F(c));s=Kl(n.serverSyncTree_,r,l,o)}else{let l=F(e);s=Yl(n.serverSyncTree_,r,l,o)}else if(i){let l=ot(e,c=>F(c));s=$l(n.serverSyncTree_,r,l)}else{let l=F(e);s=yn(n.serverSyncTree_,r,l)}let a=r;s.length>0&&(a=ji(n,r)),Me(n.eventQueue_,a,s)}function Sr(n,t){Hi(n,"connected",t),t===!1&&vc(n)}function _c(n,t){X(t,(e,i)=>{Hi(n,e,i)})}function Hi(n,t,e){let i=new T("/.info/"+t),o=F(e);n.infoData_.updateSnapshot(i,o);let r=yn(n.infoSyncTree_,i,o);Me(n.eventQueue_,i,r)}function gc(n){return n.nextWriteId_++}function vc(n){Os(n,"onDisconnectEvents");let t=ks(n),e=_n();fi(n.onDisconnect_,S(),(o,r)=>{let s=Jl(o,r,n.serverSyncTree_,t);is(e,o,s)});let i=[];fi(e,S(),(o,r)=>{i=i.concat(yn(n.serverSyncTree_,o,r));let s=wc(n,o);ji(n,s)}),n.onDisconnect_=_n(),Me(n.eventQueue_,S(),i)}function Cc(n){n.persistentConnection_&&n.persistentConnection_.interrupt(hc)}function Os(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),L(e,...t)}function Is(n,t,e){return vs(n.serverSyncTree_,t,e)||I.EMPTY_NODE}function Gi(n,t=n.transactionQueueTree_){if(t||En(n,t),et(t)){let e=Ns(n,t);_(e.length>0,"Sending zero length transaction queue"),e.every(o=>o.status===0)&&bc(n,Et(t),e)}else Ps(t)&&xn(t,e=>{Gi(n,e)})}function bc(n,t,e){let i=e.map(c=>c.currentWriteId),o=Is(n,t,i),r=o,s=o.hash();for(let c=0;c<e.length;c++){let d=e[c];_(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=K(t,d.path);r=r.updateChild(p,d.currentOutputSnapshotRaw)}let a=r.val(!0),l=t;n.server_.put(l.toString(),a,c=>{Os(n,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){let p=[];for(let m=0;m<e.length;m++)e[m].status=2,d=d.concat(qe(n.serverSyncTree_,e[m].currentWriteId)),e[m].onComplete&&p.push(()=>e[m].onComplete(null,!0,e[m].currentOutputSnapshotResolved)),e[m].unwatcher();En(n,qi(n.transactionQueueTree_,t)),Gi(n,n.transactionQueueTree_),Me(n.eventQueue_,t,d);for(let m=0;m<p.length;m++)wt(p[m])}else{if(c==="datastale")for(let p=0;p<e.length;p++)e[p].status===3?e[p].status=4:e[p].status=0;else{Y("transaction at "+l.toString()+" failed: "+c);for(let p=0;p<e.length;p++)e[p].status=4,e[p].abortReason=c}ji(n,t)}},s)}function ji(n,t){let e=Rs(n,t),i=Et(e),o=Ns(n,e);return yc(n,o,i),i}function yc(n,t,e){if(t.length===0)return;let i=[],o=[],s=t.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<t.length;a++){let l=t[a],c=K(e,l.path),d=!1,p;if(_(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,p=l.abortReason,o=o.concat(qe(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=pc)d=!0,p="maxretry",o=o.concat(qe(n.serverSyncTree_,l.currentWriteId,!0));else{let m=Is(n,l.path,s);l.currentInputSnapshot=m;let C=t[a].update(m.val());if(C!==void 0){Ms("transaction failed: Data returned ",C,l.path);let v=F(C);typeof C=="object"&&C!=null&&ae(C,".priority")||(v=v.updatePriority(m.getPriority()));let M=l.currentWriteId,_e=ks(n),ke=ec(v,m,_e);l.currentOutputSnapshotRaw=v,l.currentOutputSnapshotResolved=ke,l.currentWriteId=gc(n),s.splice(s.indexOf(M),1),o=o.concat(jl(n.serverSyncTree_,l.path,ke,l.currentWriteId,l.applyLocally)),o=o.concat(qe(n.serverSyncTree_,M,!0))}else d=!0,p="nodata",o=o.concat(qe(n.serverSyncTree_,l.currentWriteId,!0))}Me(n.eventQueue_,e,o),o=[],d&&(t[a].status=2,function(m){setTimeout(m,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&(p==="nodata"?i.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):i.push(()=>t[a].onComplete(new Error(p),!1,null))))}En(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)wt(i[a]);Gi(n,n.transactionQueueTree_)}function Rs(n,t){let e,i=n.transactionQueueTree_;for(e=w(t);e!==null&&et(i)===void 0;)i=qi(i,e),t=k(t),e=w(t);return i}function Ns(n,t){let e=[];return As(n,t,e),e.sort((i,o)=>i.order-o.order),e}function As(n,t,e){let i=et(t);if(i)for(let o=0;o<i.length;o++)e.push(i[o]);xn(t,o=>{As(n,o,e)})}function En(n,t){let e=et(t);if(e){let i=0;for(let o=0;o<e.length;o++)e[o].status!==2&&(e[i]=e[o],i++);e.length=i,Es(t,e.length>0?e:void 0)}xn(t,i=>{En(n,i)})}function wc(n,t){let e=Et(Rs(n,t)),i=qi(n.transactionQueueTree_,t);return nc(i,o=>{qn(n,o)}),qn(n,i),Ss(i,o=>{qn(n,o)}),e}function qn(n,t){let e=et(t);if(e){let i=[],o=[],r=-1;for(let s=0;s<e.length;s++)e[s].status===3||(e[s].status===1?(_(r===s-1,"All SENT items should be at beginning of queue."),r=s,e[s].status=3,e[s].abortReason="set"):(_(e[s].status===0,"Unexpected transaction status in abort"),e[s].unwatcher(),o=o.concat(qe(n.serverSyncTree_,e[s].currentWriteId,!0)),e[s].onComplete&&i.push(e[s].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Es(t,void 0):e.length=r+1,Me(n.eventQueue_,Et(t),o);for(let s=0;s<i.length;s++)wt(i[s])}}function xc(n){let t="",e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let o=e[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}t+="/"+o}return t}function Ec(n){let t={};n.charAt(0)==="?"&&(n=n.substring(1));for(let e of n.split("&")){if(e.length===0)continue;let i=e.split("=");i.length===2?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Y(`Invalid query segment '${e}' in query '${n}'`)}return t}var Tr=function(n,t){let e=Pc(n),i=e.namespace;e.domain==="firebase.com"&&pe(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&e.domain!=="localhost"&&pe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||Ca();let o=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new cn(e.host,e.secure,i,o,t,"",i!==e.subdomain),path:new T(e.pathString)}},Pc=function(n){let t="",e="",i="",o="",r="",s=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),t=n.substring(0,Math.min(d,p)),d<p&&(o=xc(n.substring(d,p)));let m=Ec(n.substring(Math.min(n.length,p)));c=t.indexOf(":"),c>=0?(s=a==="https"||a==="wss",l=parseInt(t.substring(c+1),10)):c=t.length;let C=t.slice(0,c);if(C.toLowerCase()==="localhost")e="localhost";else if(C.split(".").length<=2)e=C;else{let v=t.indexOf(".");i=t.substring(0,v).toLowerCase(),e=t.substring(v+1),r=i}"ns"in m&&(r=m.ns)}return{host:t,port:l,domain:e,subdomain:i,secure:s,scheme:a,pathString:o,namespace:r}};var Ii=class n{constructor(t,e,i,o){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=o}get key(){return y(this._path)?null:Yr(this._path)}get ref(){return new Ze(this._repo,this._path)}get _queryIdentifier(){let t=pr(this._queryParams),e=Di(t);return e==="{}"?"default":e}get _queryObject(){return pr(this._queryParams)}isEqual(t){if(t=st(t),!(t instanceof n))return!1;let e=this._repo===t._repo,i=Xr(this._path,t._path),o=this._queryIdentifier===t._queryIdentifier;return e&&i&&o}toJSON(){return this.toString()}toString(){return this._repo.toString()+Xa(this._path)}};var Ze=class n extends Ii{constructor(t,e){super(t,e,new di,!1)}get parent(){let t=Qr(this._path);return t===null?null:new n(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}};Hl(Ze);Gl(Ze);var Sc="FIREBASE_DATABASE_EMULATOR_HOST",Ri={},Tc=!1;function Mc(n,t,e,i){let o=t.lastIndexOf(":"),r=t.substring(0,o),s=it(r);n.repoInfo_=new cn(t,s,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,e),i&&(n.authTokenProvider_=i)}function kc(n,t,e,i,o){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||pe("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),L("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let s=Tr(r,o),a=s.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Sc]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,s=Tr(r,o),a=s.repoInfo):l=!s.repoInfo.secure;let d=o&&l?new ft(ft.OWNER):new Kn(n.name,n.options,t);lc("Invalid Firebase Database URL",s),y(s.path)||pe("Database URL must point to the root of a Firebase Database (not including a child path).");let p=Ic(a,n,d,new Yn(n,e));return new Ni(p,n)}function Oc(n,t){let e=Ri[t];(!e||e[n.key]!==n)&&pe(`Database ${t}(${n.repoInfo_}) has already been deleted.`),Cc(n),delete e[n.key]}function Ic(n,t,e,i){let o=Ri[t.name];o||(o={},Ri[t.name]=o);let r=o[n.toURLString()];return r&&pe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Oi(n,Tc,e,i),o[n.toURLString()]=r,r}var Ni=class{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(fc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ze(this._repo,S())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Oc(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&pe("Cannot call "+t+" on a deleted database.")}};function Ds(n=Gt(),t){let e=zt(n,"database").getImmediate({identifier:t});if(!e._instanceStarted){let i=Dt("database");i&&Ls(e,...i)}return e}function Ls(n,t,e,i={}){n=st(n),n._checkNotDeleted("useEmulator");let o=`${t}:${e}`,r=n._repoInternal;if(n._instanceStarted){if(o===n._repoInternal.repoInfo_.host&&So(i,r.repoInfo_.emulatorOptions))return;pe("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&pe('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new ft(ft.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:Ft(i.mockUserToken,n.app.options.projectId);s=new ft(a)}it(t)&&(Lt(t),Ut("Database",!0)),Mc(r,o,i,s)}function Rc(n){_a(Ht),Vt(new Wt("database",(t,{instanceIdentifier:e})=>{let i=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return kc(i,o,r,e)},"PUBLIC").setMultipleInstances(!0)),le(Ko,Qo,n),le(Ko,Qo,"esm2017")}Fi.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)};Fi.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)};Rc();var Pt=class{constructor(t){return t}},Fs="database",$i=class{constructor(){return Yt(Fs)}};var Yi=new Mt("angularfire2.database-instances");function Nc(n,t){let e=$t(Fs,n,t);return e&&new Pt(e)}function Ac(n){return(t,e)=>{let i=t.runOutsideAngular(()=>n(e));return new Pt(i)}}var Dc={provide:$i,deps:[[new ne,Yi]]},Lc={provide:Pt,useFactory:Nc,deps:[[new ne,Yi],Xt]};function Us(n,...t){return le("angularfire",jt.full,"rtdb"),kt([Lc,Dc,{provide:Yi,useFactory:Ac(n),multi:!0,deps:[Nt,Rt,Kt,Zt,[new ne,en],[new ne,Jt],...t]}])}var Bs=Qt(Ds,!0);var Gs="firebasestorage.googleapis.com",Fc="storageBucket",Uc=2*60*1e3,Bc=10*60*1e3;var ce=class n extends xo{constructor(t,e,i=0){super(Ki(t),`Firebase Storage: ${e} (${Ki(t)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Ki(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},me=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(me||{});function Ki(n){return"storage/"+n}function Wc(){let n="An unknown error occurred, please check the error payload for server response.";return new ce(me.UNKNOWN,n)}function Vc(){return new ce(me.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function zc(){return new ce(me.CANCELED,"User canceled the upload/download.")}function qc(n){return new ce(me.INVALID_URL,"Invalid URL '"+n+"'.")}function Hc(n){return new ce(me.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Ws(n){return new ce(me.INVALID_ARGUMENT,n)}function js(){return new ce(me.APP_DELETED,"The Firebase app was deleted.")}function Gc(n){return new ce(me.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var fe=class n{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let i;try{i=n.makeFromUrl(t,e)}catch{return new n(t,"")}if(i.path==="")return i;throw Hc(t)}static makeFromUrl(t,e){let i=null,o="([A-Za-z0-9.\\-_]+)";function r(H){H.path.charAt(H.path.length-1)==="/"&&(H.path_=H.path_.slice(0,-1))}let s="(/(.*))?$",a=new RegExp("^gs://"+o+s,"i"),l={bucket:1,path:3};function c(H){H.path_=decodeURIComponent(H.path)}let d="v[A-Za-z0-9_]+",p=e.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",C=new RegExp(`^https?://${p}/${d}/b/${o}/o${m}`,"i"),v={bucket:1,path:3},O=e===Gs?"(?:storage.googleapis.com|storage.cloud.google.com)":e,M="([^?#]*)",_e=new RegExp(`^https?://${O}/${o}/${M}`,"i"),te=[{regex:a,indices:l,postModify:r},{regex:C,indices:v,postModify:c},{regex:_e,indices:{bucket:1,path:2},postModify:c}];for(let H=0;H<te.length;H++){let Tt=te[H],Tn=Tt.regex.exec(t);if(Tn){let ea=Tn[Tt.indices.bucket],Mn=Tn[Tt.indices.path];Mn||(Mn=""),i=new n(ea,Mn),Tt.postModify(i);break}}if(i==null)throw qc(t);return i}},Qi=class{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}};function jc(n,t,e){let i=1,o=null,r=null,s=!1,a=0;function l(){return a===2}let c=!1;function d(...M){c||(c=!0,t.apply(null,M))}function p(M){o=setTimeout(()=>{o=null,n(C,l())},M)}function m(){r&&clearTimeout(r)}function C(M,..._e){if(c){m();return}if(M){m(),d.call(null,M,..._e);return}if(l()||s){m(),d.call(null,M,..._e);return}i<64&&(i*=2);let te;a===1?(a=2,te=0):te=(i+Math.random())*1e3,p(te)}let v=!1;function O(M){v||(v=!0,m(),!c&&(o!==null?(M||(a=2),clearTimeout(o),p(0)):M||(a=1)))}return p(0),r=setTimeout(()=>{s=!0,O(!0)},e),O}function $c(n){n(!1)}function Yc(n){return n!==void 0}function Vs(n,t,e,i){if(i<t)throw Ws(`Invalid value for '${n}'. Expected ${t} or greater.`);if(i>e)throw Ws(`Invalid value for '${n}'. Expected ${e} or less.`)}function Kc(n){let t=encodeURIComponent,e="?";for(let i in n)if(n.hasOwnProperty(i)){let o=t(i)+"="+t(n[i]);e=e+o+"&"}return e=e.slice(0,-1),e}var Xi=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Xi||{});function Qc(n,t){let e=n>=500&&n<600,o=[408,429].indexOf(n)!==-1,r=t.indexOf(n)!==-1;return e||o||r}var Zi=class{constructor(t,e,i,o,r,s,a,l,c,d,p,m=!0,C=!1){this.url_=t,this.method_=e,this.headers_=i,this.body_=o,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=d,this.connectionFactory_=p,this.retry=m,this.isUsingEmulator=C,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,O)=>{this.resolve_=v,this.reject_=O,this.start_()})}start_(){let t=(i,o)=>{if(o){i(!1,new tt(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let s=a=>{let l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(s),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(s),this.pendingConnection_=null;let a=r.getErrorCode()===Xi.NO_ERROR,l=r.getStatus();if(!a||Qc(l,this.additionalRetryCodes_)&&this.retry){let d=r.getErrorCode()===Xi.ABORT;i(!1,new tt(!1,null,d));return}let c=this.successCodes_.indexOf(l)!==-1;i(!0,new tt(c,r))})},e=(i,o)=>{let r=this.resolve_,s=this.reject_,a=o.connection;if(o.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());Yc(l)?r(l):r()}catch(l){s(l)}else if(a!==null){let l=Wc();l.serverResponse=a.getErrorText(),this.errorCallback_?s(this.errorCallback_(a,l)):s(l)}else if(o.canceled){let l=this.appDelete_?js():zc();s(l)}else{let l=Vc();s(l)}};this.canceled_?e(!1,new tt(!1,null,!0)):this.backoffId_=jc(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&$c(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},tt=class{constructor(t,e,i){this.wasSuccessCode=t,this.connection=e,this.canceled=!!i}};function Xc(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function Zc(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function Jc(n,t){t&&(n["X-Firebase-GMPID"]=t)}function eu(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function tu(n,t,e,i,o,r,s=!0,a=!1){let l=Kc(n.urlParams),c=n.url+l,d=Object.assign({},n.headers);return Jc(d,t),Xc(d,e),Zc(d,r),eu(d,i),new Zi(c,n.method,d,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,o,s,a)}function nu(n){if(n.length===0)return null;let t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function iu(n){let t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}var rh=256*1024;var Ji=class n{constructor(t,e){this._service=t,e instanceof fe?this._location=e:this._location=fe.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new n(t,e)}get root(){let t=new fe(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return iu(this._location.path)}get storage(){return this._service}get parent(){let t=nu(this._location.path);if(t===null)return null;let e=new fe(this._location.bucket,t);return new n(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw Gc(t)}};function zs(n,t){let e=t?.[Fc];return e==null?null:fe.makeFromBucketSpec(e,n)}function ou(n,t,e,i={}){n.host=`${t}:${e}`;let o=it(t);o&&(Lt(`https://${n.host}/b`),Ut("Storage",!0)),n._isUsingEmulator=!0,n._protocol=o?"https":"http";let{mockUserToken:r}=i;r&&(n._overrideAuthToken=typeof r=="string"?r:Ft(r,n.app.options.projectId))}var eo=class{constructor(t,e,i,o,r,s=!1){this.app=t,this._authProvider=e,this._appCheckProvider=i,this._url=o,this._firebaseVersion=r,this._isUsingEmulator=s,this._bucket=null,this._host=Gs,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Uc,this._maxUploadRetryTime=Bc,this._requests=new Set,o!=null?this._bucket=fe.makeFromBucketSpec(o,this._host):this._bucket=zs(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=fe.makeFromBucketSpec(this._url,t):this._bucket=zs(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Vs("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Vs("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return G(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let t=this._authProvider.getImmediate({optional:!0});if(t){let e=yield t.getToken();if(e!==null)return e.accessToken}return null})}_getAppCheckToken(){return G(this,null,function*(){if(qt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Ji(this,t)}_makeRequest(t,e,i,o,r=!0){if(this._deleted)return new Qi(js());{let s=tu(t,this._appId,i,o,e,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}makeRequestWithTokens(t,e){return G(this,null,function*(){let[i,o]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,i,o).getPromise()})}},qs="@firebase/storage",Hs="0.13.14";var $s="storage";function Ys(n=Gt(),t){n=st(n);let i=zt(n,$s).getImmediate({identifier:t}),o=Dt("storage");return o&&Ks(i,...o),i}function Ks(n,t,e,i={}){ou(n,t,e,i)}function ru(n,{instanceIdentifier:t}){let e=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),o=n.getProvider("app-check-internal");return new eo(e,i,o,t,Ht)}function su(){Vt(new Wt($s,ru,"PUBLIC").setMultipleInstances(!0)),le(qs,Hs,""),le(qs,Hs,"esm2017")}su();var St=class{constructor(t){return t}},Qs="storage",to=class{constructor(){return Yt(Qs)}};var no=new Mt("angularfire2.storage-instances");function au(n,t){let e=$t(Qs,n,t);return e&&new St(e)}function lu(n){return(t,e)=>{let i=t.runOutsideAngular(()=>n(e));return new St(i)}}var cu={provide:to,deps:[[new ne,no]]},uu={provide:St,useFactory:au,deps:[[new ne,no],Xt]};function Xs(n,...t){return le("angularfire",jt.full,"gcs"),kt([uu,cu,{provide:no,useFactory:lu(n),multi:!0,deps:[Nt,Rt,Kt,Zt,[new ne,en],[new ne,Jt],...t]}])}var Zs=Qt(Ys,!0);var Js={providers:[ao({eventCoalescing:!0}),fo(Yo),co(),No(()=>Ao(at.firebase)),Do(()=>Uo()),Vo(()=>Ho()),Us(()=>Bs()),Xs(()=>Zs())]};var du=()=>({exact:!0}),Pn=class n{constructor(t){this.router=t}navigateTo(t){console.log("Navegando para:",t),this.router.navigate([t]).then(e=>console.log("Navega\xE7\xE3o bem-sucedida:",e),e=>console.log("Erro na navega\xE7\xE3o:",e))}static \u0275fac=function(e){return new(e||n)(j(re))};static \u0275cmp=ie({type:n,selectors:[["app-sidebar"]],decls:32,vars:2,consts:[[1,"sidebar"],[1,"logo-container"],["src","assets/logo.png","alt","Logo",1,"logo-image"],[1,"menu-list"],[1,"menu-item"],["routerLinkActive","active",3,"click","routerLinkActiveOptions"],[1,"menu-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"],[1,"menu-text"],["routerLinkActive","active",3,"click"],["d","M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"],["d","M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"],["d","M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"]],template:function(e,i){e&1&&(u(0,"nav",0)(1,"div",1),b(2,"img",2),h(),u(3,"ul",3)(4,"li",4)(5,"a",5),B("click",function(){return i.navigateTo("/dashboard")}),u(6,"span",6),P(),u(7,"svg",7),b(8,"path",8),h()(),N(),u(9,"span",9),f(10,"Dashboard"),h()()(),u(11,"li",4)(12,"a",10),B("click",function(){return i.navigateTo("/ativos")}),u(13,"span",6),P(),u(14,"svg",7),b(15,"path",11),h()(),N(),u(16,"span",9),f(17,"Ativos"),h()()(),u(18,"li",4)(19,"a",10),B("click",function(){return i.navigateTo("/chamados")}),u(20,"span",6),P(),u(21,"svg",7),b(22,"path",12),h()(),N(),u(23,"span",9),f(24,"Chamados"),h()()(),u(25,"li",4)(26,"a",10),B("click",function(){return i.navigateTo("/relatorios")}),u(27,"span",6),P(),u(28,"svg",7),b(29,"path",13),h()(),N(),u(30,"span",9),f(31,"Relat\xF3rios"),h()()()()()),e&2&&(g(5),E("routerLinkActiveOptions",so(1,du)))},dependencies:[po,oe],styles:[".sidebar[_ngcontent-%COMP%]{width:250px;background-color:var(--color-background-light);border-right:1px solid var(--color-border);padding:20px 0;display:flex;flex-direction:column;height:100vh}.logo-container[_ngcontent-%COMP%]{padding:0 20px 30px;border-bottom:1px solid var(--color-border);margin-bottom:20px;text-align:center}.logo-image[_ngcontent-%COMP%]{max-width:180px;max-height:50px;object-fit:contain}.menu-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.menu-item[_ngcontent-%COMP%]{margin-bottom:2px}.menu-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px 20px;color:var(--color-text-secondary);text-decoration:none;transition:all .3s ease;border-radius:0;position:relative;cursor:pointer}.menu-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#007bff33,#007bff0d);color:var(--color-text-primary);transform:translate(4px);transition:all .3s ease}.menu-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover   .menu-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.menu-item[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:var(--color-background-dark);color:var(--color-text-primary);border-right:3px solid var(--color-accent-blue)}.menu-item[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]   .menu-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--color-accent-blue)}.menu-icon[_ngcontent-%COMP%]{margin-right:15px;display:flex;align-items:center;justify-content:center;width:24px;height:24px}.menu-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--color-text-secondary);transition:color .3s ease}"]})};function hu(n,t){n&1&&(u(0,"div",2),b(1,"app-sidebar"),u(2,"main",3),b(3,"router-outlet"),h()())}function pu(n,t){n&1&&(u(0,"div",4),b(1,"router-outlet"),h())}var Sn=class n{constructor(t){this.router=t;this.router.events.pipe(oo(e=>e instanceof uo)).subscribe(e=>{this.currentRoute=e.url})}title="frontend-design";currentRoute="";isAuthPage(){return["/login","/cadastro","/esqueci-senha","/"].includes(this.currentRoute)}static \u0275fac=function(e){return new(e||n)(j(re))};static \u0275cmp=ie({type:n,selectors:[["app-root"]],decls:2,vars:2,consts:[["class","app-container",4,"ngIf"],["class","auth-container",4,"ngIf"],[1,"app-container"],[1,"main-content"],[1,"auth-container"]],template:function(e,i){e&1&&$(0,hu,4,0,"div",0)(1,pu,2,0,"div",1),e&2&&(E("ngIf",!i.isAuthPage()),g(),E("ngIf",i.isAuthPage()))},dependencies:[ho,Pn,oe,ge],styles:[".app-container[_ngcontent-%COMP%]{display:flex;height:100vh;background-color:var(--color-background-dark);color:var(--color-text-primary)}.main-content[_ngcontent-%COMP%]{flex:1;padding:20px;overflow-y:auto;background-color:var(--color-background-medium)}.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,var(--color-background-dark) 0%,var(--color-background-medium) 100%);display:flex;align-items:center;justify-content:center;padding:20px}"]})};lo(Sn,Js).catch(n=>console.error(n));
