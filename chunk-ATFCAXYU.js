import{$b as r,Tb as i,Ub as M,Wb as m,Xb as v,Yb as g,Zb as y,_b as C,a as n,b as c,bc as w,cc as u,dc as p,e as h,fc as T,gc as f,h as o,o as b,r as O}from"./chunk-BRSLBDDL.js";var H=class A{firestore=O(M);assetsCollection=y(this.firestore,"ativos");chamadosCollection=y(this.firestore,"chamados");constructor(){}convertTimestampsToDates(e){if(!e)return e;let t=n({},e);return t.createdAt instanceof i&&(t.createdAt=t.createdAt.toDate()),t.updatedAt instanceof i&&(t.updatedAt=t.updatedAt.toDate()),t.lastMaintenance instanceof i&&(t.lastMaintenance=t.lastMaintenance.toDate()),t.dueDate instanceof i&&(t.dueDate=t.dueDate.toDate()),t.resolvedAt instanceof i&&(t.resolvedAt=t.resolvedAt.toDate()),t.maintenanceHistory&&Array.isArray(t.maintenanceHistory)&&(t.maintenanceHistory=t.maintenanceHistory.map(a=>c(n({},a),{date:a.date instanceof i?a.date.toDate():a.date}))),t}convertDatesToTimestamps(e){if(!e)return e;let t=n({},e);return t.createdAt instanceof Date&&(t.createdAt=i.fromDate(t.createdAt)),t.updatedAt instanceof Date&&(t.updatedAt=i.fromDate(t.updatedAt)),t.lastMaintenance instanceof Date&&(t.lastMaintenance=i.fromDate(t.lastMaintenance)),t.dueDate instanceof Date&&(t.dueDate=i.fromDate(t.dueDate)),t.resolvedAt instanceof Date&&(t.resolvedAt=i.fromDate(t.resolvedAt)),t.maintenanceHistory&&Array.isArray(t.maintenanceHistory)&&(t.maintenanceHistory=t.maintenanceHistory.map(a=>c(n({},a),{date:a.date instanceof Date?i.fromDate(a.date):a.date}))),t}getAssets(){let e=p(this.assetsCollection,u("name"));return m(e,{idField:"id"}).pipe(o(t=>t.map(a=>this.convertTimestampsToDates(a))))}getAsset(e){let t=r(this.assetsCollection,e);return v(t,{idField:"id"}).pipe(o(a=>this.convertTimestampsToDates(a)))}addAsset(e){let t=new Date,a=c(n({},e),{createdAt:t,updatedAt:t,lastMaintenance:e.lastMaintenance||null,maintenanceHistory:e.maintenanceHistory||[]});return g(this.assetsCollection,this.convertDatesToTimestamps(a))}updateAsset(e){if(!e.id)return Promise.reject(new Error("O ID do ativo \xE9 necess\xE1rio para atualiza\xE7\xE3o."));let t=r(this.firestore,`ativos/${e.id}`),a=c(n({},e),{updatedAt:new Date});return T(t,this.convertDatesToTimestamps(a))}deleteAsset(e){let t=r(this.firestore,`ativos/${e}`);return C(t)}getRecentAssets(e=3){let t=p(this.assetsCollection,u("createdAt","desc"),w(e));return m(t,{idField:"id"}).pipe(o(a=>a.map(s=>this.convertTimestampsToDates(s))))}getTotalAssetsCount(){return this.getAssets().pipe(o(e=>e.length))}getChamados(){let e=p(this.chamadosCollection,u("createdAt","desc"));return m(e,{idField:"id"}).pipe(o(t=>t.map(a=>{let s=this.convertTimestampsToDates(a);return s.titulo!==void 0&&(s.title=s.titulo,delete s.titulo),s})))}getChamado(e){let t=r(this.chamadosCollection,e);return v(t,{idField:"id"}).pipe(o(a=>{let s=this.convertTimestampsToDates(a);return s.titulo!==void 0&&(s.title=s.titulo,delete s.titulo),s}))}addChamado(e){return h(this,null,function*(){let t=new Date,a=c(n({},e),{createdAt:t,status:e.status||"Aberto"});return a.title!==void 0&&(a.titulo=a.title,delete a.title),yield g(this.chamadosCollection,this.convertDatesToTimestamps(a))})}updateChamado(e){return h(this,null,function*(){if(!e.id)return Promise.reject(new Error("O ID do chamado \xE9 necess\xE1rio para atualiza\xE7\xE3o."));let t=r(this.chamadosCollection,e.id),a=n({},e);a.title!==void 0&&(a.titulo=a.title,delete a.title),delete a.id,yield T(t,this.convertDatesToTimestamps(a))})}deleteChamado(e){let t=r(this.chamadosCollection,e);return C(t)}getChamadosFiltrados(e,t,a,s){let d=[];if(e&&d.push(f("status","==",e)),s&&d.push(f("priority","==",s)),t&&d.push(f("createdAt",">=",i.fromDate(t))),a){let D=new Date(a.getTime());D.setHours(23,59,59,999),d.push(f("createdAt","<=",i.fromDate(D)))}d.push(u("createdAt","desc"));let F=p(this.chamadosCollection,...d);return m(F,{idField:"id"}).pipe(o(D=>D.map(P=>{let l=this.convertTimestampsToDates(P);return l.titulo!==void 0&&(l.title=l.titulo,delete l.titulo),l})))}static \u0275fac=function(t){return new(t||A)};static \u0275prov=b({token:A,factory:A.\u0275fac,providedIn:"root"})};export{H as a};
