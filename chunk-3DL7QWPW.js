import{Ob as i,Pb as T,Rb as d,Sb as f,Tb as D,Ub as A,Vb as v,Wb as r,Yb as C,Zb as l,_b as m,a as n,ac as h,b as c,c as u,f as o,m as g,p as y}from"./chunk-VS7D342T.js";var b=class p{firestore=y(T);assetsCollection=A(this.firestore,"ativos");chamadosCollection=A(this.firestore,"chamados");constructor(){}convertTimestampsToDates(e){if(!e)return e;let t=n({},e);return t.createdAt instanceof i&&(t.createdAt=t.createdAt.toDate()),t.updatedAt instanceof i&&(t.updatedAt=t.updatedAt.toDate()),t.lastMaintenance instanceof i&&(t.lastMaintenance=t.lastMaintenance.toDate()),t.dueDate instanceof i&&(t.dueDate=t.dueDate.toDate()),t.resolvedAt instanceof i&&(t.resolvedAt=t.resolvedAt.toDate()),t.maintenanceHistory&&Array.isArray(t.maintenanceHistory)&&(t.maintenanceHistory=t.maintenanceHistory.map(a=>c(n({},a),{date:a.date instanceof i?a.date.toDate():a.date}))),t}convertDatesToTimestamps(e){if(!e)return e;let t=n({},e);return t.createdAt instanceof Date&&(t.createdAt=i.fromDate(t.createdAt)),t.updatedAt instanceof Date&&(t.updatedAt=i.fromDate(t.updatedAt)),t.lastMaintenance instanceof Date&&(t.lastMaintenance=i.fromDate(t.lastMaintenance)),t.dueDate instanceof Date&&(t.dueDate=i.fromDate(t.dueDate)),t.resolvedAt instanceof Date&&(t.resolvedAt=i.fromDate(t.resolvedAt)),t.maintenanceHistory&&Array.isArray(t.maintenanceHistory)&&(t.maintenanceHistory=t.maintenanceHistory.map(a=>c(n({},a),{date:a.date instanceof Date?i.fromDate(a.date):a.date}))),t}getAssets(){let e=m(this.assetsCollection,l("name"));return d(e,{idField:"id"}).pipe(o(t=>t.map(a=>this.convertTimestampsToDates(a))))}getAsset(e){let t=r(this.assetsCollection,e);return f(t,{idField:"id"}).pipe(o(a=>this.convertTimestampsToDates(a)))}addAsset(e){let t=new Date,a=c(n({},e),{createdAt:t,updatedAt:t,lastMaintenance:e.lastMaintenance||null,maintenanceHistory:e.maintenanceHistory||[]});return D(this.assetsCollection,this.convertDatesToTimestamps(a))}updateAsset(e){if(!e.id)return Promise.reject(new Error("O ID do ativo \xE9 necess\xE1rio para atualiza\xE7\xE3o."));let t=r(this.firestore,`ativos/${e.id}`),a=c(n({},e),{updatedAt:new Date});return h(t,this.convertDatesToTimestamps(a))}deleteAsset(e){let t=r(this.firestore,`ativos/${e}`);return v(t)}getRecentAssets(e=3){let t=m(this.assetsCollection,l("createdAt","desc"),C(e));return d(t,{idField:"id"}).pipe(o(a=>a.map(s=>this.convertTimestampsToDates(s))))}getTotalAssetsCount(){return this.getAssets().pipe(o(e=>e.length))}getChamados(){let e=m(this.chamadosCollection,l("createdAt","desc"));return d(e,{idField:"id"}).pipe(o(t=>t.map(a=>{let s=this.convertTimestampsToDates(a);return s.titulo!==void 0&&(s.title=s.titulo,delete s.titulo),s})))}getChamado(e){let t=r(this.chamadosCollection,e);return f(t,{idField:"id"}).pipe(o(a=>{let s=this.convertTimestampsToDates(a);return s.titulo!==void 0&&(s.title=s.titulo,delete s.titulo),s}))}addChamado(e){return u(this,null,function*(){let t=new Date,a=c(n({},e),{createdAt:t,status:e.status||"Aberto"});return a.title!==void 0&&(a.titulo=a.title,delete a.title),yield D(this.chamadosCollection,this.convertDatesToTimestamps(a))})}updateChamado(e){return u(this,null,function*(){if(!e.id)return Promise.reject(new Error("O ID do chamado \xE9 necess\xE1rio para atualiza\xE7\xE3o."));let t=r(this.chamadosCollection,e.id),a=n({},e);a.title!==void 0&&(a.titulo=a.title,delete a.title),delete a.id,yield h(t,this.convertDatesToTimestamps(a))})}deleteChamado(e){let t=r(this.chamadosCollection,e);return v(t)}static \u0275fac=function(t){return new(t||p)};static \u0275prov=g({token:p,factory:p.\u0275fac,providedIn:"root"})};export{b as a};
